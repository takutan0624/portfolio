<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Twilight Fishing - Cinematic Edition</title>
    <!-- Three.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        :root {
            --primary: #4cc9f0;
            --secondary: #4361ee;
            --accent: #f72585;
            --gold: #f59e0b;
            --bg-dark: #020617;
            --glass: rgba(15, 23, 42, 0.75);
            --glass-border: rgba(255, 255, 255, 0.15);
            --text-light: #f8fafc;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #game-wrapper {
            position: relative;
            width: 100%;
            max-width: 1000px;
            height: 100%;
            max-height: 700px;
            background: #020617;
            border-radius: 32px;
            box-shadow: 0 0 80px rgba(0, 0, 0, 0.9);
            overflow: hidden;
            margin: 10px;
            border: 1px solid var(--glass-border);
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* --- UI OVERLAY --- */
        .overlay {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 10;
        }

        .interactive {
            pointer-events: auto;
        }

        /* Stats Panel */
        #stats-bar {
            position: absolute;
            top: 25px;
            left: 25px;
            right: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .glass-panel {
            background: var(--glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 12px 24px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .stat-item {
            display: flex;
            flex-direction: column;
        }

        .stat-label {
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #94a3b8;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 900;
            color: var(--primary);
            text-shadow: 0 0 12px rgba(76, 201, 240, 0.4);
        }

        /* æ”¹è‰¯ã•ã‚ŒãŸå›³é‘‘ãƒœã‚¿ãƒ³ */
        #book-btn {
            height: 54px;
            padding: 0 20px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, #fbbf24, #d97706);
            border: 1px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            pointer-events: auto;
            color: #fff;
            font-weight: 900;
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(217, 119, 6, 0.4);
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        #book-btn:hover {
            transform: scale(1.05) translateY(-2px);
            box-shadow: 0 6px 20px rgba(217, 119, 6, 0.5);
        }

        #book-btn:active {
            transform: scale(0.95);
        }

        /* Controls */
        #controls {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        #power-meter {
            width: 200px;
            height: 8px;
            background: rgba(0,0,0,0.6);
            border-radius: 10px;
            overflow: hidden;
            opacity: 0;
            transition: opacity 0.3s;
            border: 1px solid rgba(255,255,255,0.1);
        }

        #power-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            box-shadow: 0 0 15px var(--primary);
        }

        #action-btn {
            width: 200px;
            height: 64px;
            border-radius: 32px;
            border: none;
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            color: white;
            font-size: 20px;
            font-weight: 900;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.5);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            justify-content: center;
            align-items: center;
            letter-spacing: 1px;
        }

        #action-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 35px rgba(67, 97, 238, 0.6);
        }

        #action-btn:active { transform: scale(0.95); }
        #action-btn:disabled { background: #1e293b; opacity: 0.7; cursor: not-allowed; }

        /* Catch Modal */
        #modal-overlay {
            position: absolute;
            inset: 0;
            background: rgba(2, 6, 23, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
            backdrop-filter: blur(12px);
        }

        #catch-modal {
            width: 340px;
            padding: 40px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.15);
        }

        .modal-icon { font-size: 80px; margin-bottom: 10px; }
        .modal-rarity {
            display: inline-block;
            padding: 4px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 900;
            margin-bottom: 15px;
        }
        .rarity-common { background: #475569; }
        .rarity-uncommon { background: #16a34a; }
        .rarity-rare { background: #2563eb; }
        .rarity-epic { background: #9333ea; }
        .rarity-legendary { background: #eab308; color: #000; box-shadow: 0 0 25px #eab308; }

        .modal-title { font-size: 28px; font-weight: 900; margin-bottom: 5px; }
        .modal-value { font-size: 22px; color: #fcd34d; margin-bottom: 25px; font-weight: 900; display: block; }
        .close-btn { width: 100%; padding: 16px; border-radius: 12px; border: none; background: var(--primary); color: white; font-weight: 800; cursor: pointer; font-size: 16px; }

        #collection-view { position: absolute; inset: 20px; background: rgba(15, 23, 42, 0.98); border-radius: 28px; padding: 30px; z-index: 200; display: none; flex-direction: column; border: 1px solid var(--glass-border); }
        #collection-view.show { display: flex; }
        .collection-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; overflow-y: auto; padding: 10px; margin-top: 20px; }
        .fish-card { background: rgba(255,255,255,0.05); border-radius: 20px; padding: 20px; text-align: center; border: 1px solid rgba(255,255,255,0.1); }
        .fish-card.locked { opacity: 0.2; }
        .toast { position: absolute; top: 120px; left: 50%; transform: translateX(-50%); padding: 12px 24px; background: var(--accent); border-radius: 10px; font-weight: 900; display: none; z-index: 50; box-shadow: 0 10px 20px rgba(0,0,0,0.4); }
        .shake { animation: shake 0.4s infinite; }
        @keyframes shake {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(-4px, 2px); }
            50% { transform: translate(4px, -2px); }
            75% { transform: translate(-4px, -2px); }
        }
    </style>
</head>
<body>

<div id="game-wrapper">
    <div id="canvas-container" style="width: 100%; height: 100%;"></div>

    <div class="overlay">
        <div id="stats-bar">
            <div class="glass-panel" style="display: flex; gap: 30px;">
                <div class="stat-item">
                    <span class="stat-label">æ‰€æŒé‡‘</span>
                    <span class="stat-value">Â¥<span id="ui-money">0</span></span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">é‡£æœ</span>
                    <span class="stat-value"><span id="ui-caught">0</span> åŒ¹</span>
                </div>
            </div>
            <div style="display: flex; gap: 15px; align-items: center;">
                <div class="glass-panel interactive" style="display: flex; gap: 10px; align-items: center; padding: 10px 16px;">
                    <span id="time-icon" style="font-size: 24px;">â˜€ï¸</span>
                    <span id="time-name" style="font-weight: 900; font-size: 14px;">æ˜¼</span>
                    <button id="time-btn" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; padding: 4px 12px; color: white; cursor: pointer; font-size: 12px; font-weight: 700; pointer-events: auto;">å¤‰æ›´</button>
                </div>
                <div class="glass-panel interactive" style="display: flex; gap: 10px; align-items: center; padding: 10px 16px;">
                    <span id="weather-icon" style="font-size: 24px;">â˜€ï¸</span>
                    <span id="weather-name" style="font-weight: 900; font-size: 14px;">æ™´ã‚Œ</span>
                    <button id="weather-btn" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; padding: 4px 12px; color: white; cursor: pointer; font-size: 12px; font-weight: 700; pointer-events: auto;">å¤‰æ›´</button>
                </div>
                <div id="location-btn" style="height: 54px; padding: 0 20px; border-radius: 16px; display: flex; align-items: center; gap: 10px; background: linear-gradient(135deg, #0ea5e9, #0284c7); border: 1px solid rgba(255, 255, 255, 0.3); cursor: pointer; pointer-events: auto; color: #fff; font-weight: 900; font-size: 16px; box-shadow: 0 4px 15px rgba(14, 165, 233, 0.4); transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);">
                    <span id="location-icon" style="font-size: 20px;">âš“</span>
                    <span id="location-name">æ¸¯</span>
                </div>
                <div id="book-btn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>
                    <span>å›³é‘‘</span>
                </div>
            </div>
        </div>

        <div id="toast" class="toast">é€ƒã’ã‚‰ã‚ŒãŸï¼</div>

        <div id="controls" class="interactive">
            <div id="power-meter"><div id="power-fill"></div></div>
            <button id="action-btn"><span id="btn-text">æŠ•ã’ã‚‹</span></button>
        </div>

        <div id="collection-view" class="interactive">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2 style="font-size: 24px; font-weight: 900;">ãŠã•ã‹ãªå›³é‘‘</h2>
                <button id="close-collection" style="background:none; border:none; color:white; cursor:pointer; padding: 10px;">
                    <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <div class="collection-grid" id="collection-grid"></div>
        </div>

        <div id="location-view" class="interactive" style="position: absolute; inset: 20px; background: rgba(15, 23, 42, 0.98); border-radius: 28px; padding: 30px; z-index: 200; display: none; flex-direction: column; border: 1px solid var(--glass-border);">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2 style="font-size: 24px; font-weight: 900;">é‡£ã‚Šå ´é¸æŠ</h2>
                <button id="close-location" style="background:none; border:none; color:white; cursor:pointer; padding: 10px;">
                    <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <div id="location-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; overflow-y: auto; padding: 10px; margin-top: 20px;"></div>
        </div>

        <div id="modal-overlay" class="interactive">
            <div id="catch-modal" class="glass-panel">
                <div class="modal-icon" id="res-icon">ğŸŸ</div>
                <div class="modal-rarity rarity-rare" id="res-rarity">RARE</div>
                <h3 class="modal-title" id="res-name">ã‚¯ãƒ­ãƒã‚°ãƒ­</h3>
                <div style="display: flex; gap: 20px; justify-content: center; margin-bottom: 10px;">
                    <span style="font-size: 16px; font-weight: 700; color: #94a3b8;" id="res-size">35cm</span>
                    <span style="font-size: 16px; font-weight: 700; color: #94a3b8;" id="res-weight">2.5kg</span>
                </div>
                <span class="modal-value" id="res-value">+Â¥500</span>
                <button class="close-btn" id="close-modal">ç¢ºèª</button>
            </div>
        </div>

        <div id="trivia-overlay" class="interactive" style="position: absolute; inset: 0; background: rgba(2, 6, 23, 0.85); display: none; justify-content: center; align-items: center; z-index: 100; backdrop-filter: blur(12px);">
            <div id="trivia-modal" class="glass-panel" style="width: 400px; padding: 40px; text-align: center;">
                <div style="font-size: 60px; margin-bottom: 10px;" id="trivia-icon">ğŸŸ</div>
                <h3 style="font-size: 24px; font-weight: 900; margin-bottom: 10px;" id="trivia-name">ã‚¯ãƒ­ãƒã‚°ãƒ­</h3>
                <div style="font-size: 14px; line-height: 1.6; color: #cbd5e1; margin-bottom: 20px; text-align: left;" id="trivia-text">ãƒˆãƒªãƒ“ã‚¢ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
                <button class="close-btn" id="close-trivia">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>
</div>

<script>
    const TIME_OF_DAY = {
        morning: { name: 'æœ', icon: 'ğŸŒ…', bg: 0x4a5f7f, fog: 0x8aa5c5, sunColor: 0xffa500, sunIntensity: 0.8, ambientIntensity: 0.5 },
        day: { name: 'æ˜¼', icon: 'â˜€ï¸', bg: 0x87ceeb, fog: 0xadd8e6, sunColor: 0xffee88, sunIntensity: 1.2, ambientIntensity: 0.7 },
        evening: { name: 'å¤•æ–¹', icon: 'ğŸŒ‡', bg: 0x3d2f5b, fog: 0x7a5c8f, sunColor: 0xff6b35, sunIntensity: 0.9, ambientIntensity: 0.4 },
        night: { name: 'å¤œ', icon: 'ğŸŒ™', bg: 0x0a0e27, fog: 0x1a1f3a, sunColor: 0x4466ff, sunIntensity: 0.3, ambientIntensity: 0.3 }
    };

    const WEATHER = {
        sunny: { name: 'æ™´ã‚Œ', icon: 'â˜€ï¸', rareFishBonus: 1.0, fogDensity: 0.025 },
        cloudy: { name: 'æ›‡ã‚Š', icon: 'â˜ï¸', rareFishBonus: 1.2, fogDensity: 0.035 },
        rainy: { name: 'é›¨', icon: 'ğŸŒ§ï¸', rareFishBonus: 1.5, fogDensity: 0.04 }
    };

    const LOCATIONS = {
        harbor: { name: 'æ¸¯', icon: 'âš“', cost: 0, description: 'æµ·é‡£ã‚Šã®åŸºæœ¬ã‚¹ãƒãƒƒãƒˆ' },
        river: { name: 'å·', icon: 'ğŸï¸', cost: 3000, description: 'æ·¡æ°´é­šãŒè±Šå¯Œ' },
        lake: { name: 'æ¹–', icon: 'ğŸ”ï¸', cost: 8000, description: 'å¤§ç‰©ãŒæ½œã‚€é™ã‹ãªæ¹–' },
        deepsea: { name: 'æ·±æµ·', icon: 'ğŸŒŠ', cost: 50000, description: 'ä¼èª¬ã®é­šãŒçœ ã‚‹å ´æ‰€' }
    };

    const FISH_DATA = [
        // æ¸¯ - å…±é€šæµ·é­š
        { id: 1, name: 'ã‚¢ã‚¸', icon: 'ğŸŸ', rarity: 'common', value: 50, chance: 40, rarityJp: 'ã‚³ãƒ¢ãƒ³', sizeRange: [15, 35], weightRange: [0.1, 0.5], conditions: {}, location: ['harbor'], trivia: 'ç¾¤ã‚Œã§æ³³ãç¿’æ€§ãŒã‚ã‚Šã€ã€Œã‚¢ã‚¸ã®é–‹ãã€ã¨ã„ã†å¹²ç‰©ã¯å®Ÿã¯èƒŒé–‹ãã§ã¯ãªãè…¹é–‹ããŒä¸€èˆ¬çš„ã€‚' },
        { id: 2, name: 'ã‚¤ãƒ¯ã‚·', icon: 'ğŸŸ', rarity: 'common', value: 40, chance: 35, rarityJp: 'ã‚³ãƒ¢ãƒ³', sizeRange: [10, 20], weightRange: [0.05, 0.15], conditions: {}, location: ['harbor'], trivia: 'é ­ãŒã„ã„ã¨ã„ã†æ„å‘³ã®ã€Œã‚¤ãƒ¯ã‚·ã®é ­ã‚‚ä¿¡å¿ƒã‹ã‚‰ã€ã¯ã€å®Ÿã¯åˆ¥ã®é­šã®è©±ã ã£ãŸèª¬ã‚‚ã‚ã‚‹ã€‚DHAãƒ»EPAãŒè±Šå¯Œã§è„³ã«è‰¯ã„ã€‚' },
        { id: 3, name: 'ã‚µãƒ', icon: 'ğŸ ', rarity: 'common', value: 60, chance: 30, rarityJp: 'ã‚³ãƒ¢ãƒ³', sizeRange: [20, 40], weightRange: [0.2, 0.8], conditions: {}, location: ['harbor'], trivia: 'æ­»ã¬ã¨æ€¥é€Ÿã«é®®åº¦ãŒè½ã¡ã‚‹ãŸã‚ã€Œã‚µãƒã®ç”Ÿãè…ã‚Œã€ã¨ã„ã†è¨€è‘‰ãŒã‚ã‚‹ã€‚å®Ÿã¯æ™‚é€Ÿ80kmã§æ³³ã’ã‚‹é«˜é€Ÿé­šã€‚' },

        // æ¸¯ - æœé™å®š
        { id: 4, name: 'ã‚µãƒ¨ãƒª', icon: 'ğŸŸ', rarity: 'common', value: 80, chance: 25, rarityJp: 'ã‚³ãƒ¢ãƒ³', sizeRange: [20, 40], weightRange: [0.15, 0.4], conditions: { time: ['morning'] }, location: ['harbor'], trivia: 'ä¸‹ã‚ã”ãŒé•·ãçªãå‡ºã¦ã„ã‚‹ç‹¬ç‰¹ã®å½¢çŠ¶ã€‚ã‚¸ãƒ£ãƒ³ãƒ—åŠ›ãŒå¼·ãã€èˆ¹ã«é£›ã³è¾¼ã‚“ã§ãã‚‹ã“ã¨ã‚‚ã‚ã‚‹ã€‚' },
        { id: 5, name: 'ãƒ¡ãƒãƒ«', icon: 'ğŸŸ', rarity: 'uncommon', value: 150, chance: 15, rarityJp: 'ã‚¢ãƒ³ã‚³ãƒ¢ãƒ³', sizeRange: [15, 30], weightRange: [0.2, 0.8], conditions: { time: ['morning'] }, location: ['harbor'], trivia: 'ç›®ãŒå¼µã‚Šå‡ºã—ã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ã€Œç›®å¼µã‚‹ã€ãŒåå‰ã®ç”±æ¥ã€‚å®Ÿã¯åµèƒç”Ÿã§ã€åµã§ã¯ãªãç¨šé­šã‚’ç”£ã‚€çã—ã„é­šã€‚' },
        { id: 6, name: 'ã‚«ãƒ¬ã‚¤', icon: 'ğŸŸ', rarity: 'uncommon', value: 200, chance: 12, rarityJp: 'ã‚¢ãƒ³ã‚³ãƒ¢ãƒ³', sizeRange: [25, 50], weightRange: [0.5, 2.0], conditions: { time: ['morning'] }, location: ['harbor'], trivia: 'ã€Œå·¦ãƒ’ãƒ©ãƒ¡ã«å³ã‚«ãƒ¬ã‚¤ã€ã¨è¨€ã‚ã‚Œã‚‹ãŒã€å®Ÿã¯ä¾‹å¤–ã‚‚å¤šã„ã€‚ç ‚ã«æ½œã£ã¦ç›®ã ã‘å‡ºã—ã¦ç²ç‰©ã‚’å¾…ã¤ã€‚' },

        // æ¸¯ - æ˜¼é™å®š
        { id: 7, name: 'ã‚¢ã‚ªãƒªã‚¤ã‚«', icon: 'ğŸ¦‘', rarity: 'uncommon', value: 250, chance: 18, rarityJp: 'ã‚¢ãƒ³ã‚³ãƒ¢ãƒ³', sizeRange: [20, 50], weightRange: [0.5, 3.0], conditions: { time: ['day'] }, location: ['harbor'], trivia: 'ã‚¤ã‚«ã®ä¸­ã§ã‚‚æœ€ã‚‚ç¾å‘³ã¨ã•ã‚Œã‚‹é«˜ç´šç¨®ã€‚å®Ÿã¯è‰²ã‚’å¤‰ãˆã¦ä»²é–“ã¨ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å–ã‚‹çŸ¥èƒ½ã®é«˜ã„ç”Ÿç‰©ã€‚' },
        { id: 8, name: 'ã‚¿ãƒã‚¦ã‚ª', icon: 'âš”ï¸', rarity: 'uncommon', value: 220, chance: 16, rarityJp: 'ã‚¢ãƒ³ã‚³ãƒ¢ãƒ³', sizeRange: [60, 150], weightRange: [0.8, 3.5], conditions: { time: ['day'] }, location: ['harbor'], trivia: 'ç«‹ã£ã¦æ³³ãå§¿ã‹ã‚‰ã€Œå¤ªåˆ€é­šã€ã®åå‰ãŒã¤ã„ãŸã€‚é‹­ã„æ­¯ã‚’æŒã¡ã€é‡£ã‚Šä¸Šã’ã‚‹éš›ã«å™›ã¾ã‚Œã‚‹ã“ã¨ã‚‚ã€‚' },
        { id: 9, name: 'ãƒ–ãƒª', icon: 'ğŸŸ', rarity: 'rare', value: 600, chance: 10, rarityJp: 'ãƒ¬ã‚¢', sizeRange: [50, 120], weightRange: [3, 15], conditions: { time: ['day'] }, location: ['harbor'], trivia: 'å‡ºä¸–é­šã§ã€æˆé•·ã¨ã¨ã‚‚ã«å‘¼ã³åãŒå¤‰ã‚ã‚‹ï¼ˆãƒ¯ã‚«ã‚·â†’ã‚¤ãƒŠãƒ€â†’ãƒ¯ãƒ©ã‚µâ†’ãƒ–ãƒªï¼‰ã€‚æ™‚é€Ÿ40kmã§æ³³ãã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¹ã‚¿ãƒ¼ã€‚' },

        // æ¸¯ - å¤•æ–¹é™å®š
        { id: 10, name: 'ã‚¹ã‚ºã‚­', icon: 'ğŸŸ', rarity: 'uncommon', value: 280, chance: 20, rarityJp: 'ã‚¢ãƒ³ã‚³ãƒ¢ãƒ³', sizeRange: [40, 100], weightRange: [1, 8], conditions: { time: ['evening'] }, location: ['harbor'], trivia: 'ã“ã‚Œã‚‚å‡ºä¸–é­šã€‚ã‚»ã‚¤ã‚´â†’ãƒ•ãƒƒã‚³â†’ã‚¹ã‚ºã‚­ã¨å‘¼ã³åãŒå¤‰ã‚ã‚‹ã€‚å¤œè¡Œæ€§ã§ã€å¤•æ–¹ã‹ã‚‰æ´»ç™ºã«ãªã‚‹ã€‚' },
        { id: 11, name: 'ãƒ’ãƒ©ãƒ¡', icon: 'ğŸŸ', rarity: 'rare', value: 700, chance: 12, rarityJp: 'ãƒ¬ã‚¢', sizeRange: [30, 80], weightRange: [1, 10], conditions: { time: ['evening'] }, location: ['harbor'], trivia: 'ã€Œå·¦ãƒ’ãƒ©ãƒ¡ã€ã¯ç›®ãŒå·¦å´ã«ã‚ã‚‹ã“ã¨ã‹ã‚‰ã€‚ç ‚ã«éš ã‚Œã¦ç²ç‰©ã‚’å¾…ã¡ä¼ã›ã™ã‚‹å¾…ã¡ä¼ã›ãƒãƒ³ã‚¿ãƒ¼ã€‚' },
        { id: 12, name: 'ã‚¤ã‚µã‚­', icon: 'ğŸŸ', rarity: 'uncommon', value: 180, chance: 15, rarityJp: 'ã‚¢ãƒ³ã‚³ãƒ¢ãƒ³', sizeRange: [20, 40], weightRange: [0.3, 1.5], conditions: { time: ['evening'] }, location: ['harbor'], trivia: 'å¹¼é­šã«ã¯ç¸æ¨¡æ§˜ãŒã‚ã‚Šã€Œã‚¦ãƒªãƒœã‚¦ã€ã¨å‘¼ã°ã‚Œã‚‹ã€‚å¤•æš®ã‚Œæ™‚ã«ç¾¤ã‚Œã§å²©ç¤ã‚’ç§»å‹•ã™ã‚‹ç¿’æ€§ãŒã‚ã‚‹ã€‚' },

        // æ¸¯ - å¤œé™å®š
        { id: 13, name: 'ã‚¢ãƒŠã‚´', icon: 'ğŸ', rarity: 'uncommon', value: 190, chance: 18, rarityJp: 'ã‚¢ãƒ³ã‚³ãƒ¢ãƒ³', sizeRange: [30, 90], weightRange: [0.2, 1.2], conditions: { time: ['night'] }, location: ['harbor'], trivia: 'ã‚¦ãƒŠã‚®ã«ä¼¼ã¦ã„ã‚‹ãŒåˆ¥ç¨®ã€‚å¤œè¡Œæ€§ã§ã€æ˜¼é–“ã¯ç ‚ã«æ½œã£ã¦é ­ã ã‘å‡ºã—ã¦ã„ã‚‹ã€‚å®Ÿã¯ã‚¦ãƒŠã‚®ã‚ˆã‚Šä½ã‚«ãƒ­ãƒªãƒ¼ã€‚' },
        { id: 14, name: 'ã‚¦ãƒ„ãƒœ', icon: 'ğŸ', rarity: 'rare', value: 500, chance: 8, rarityJp: 'ãƒ¬ã‚¢', sizeRange: [40, 200], weightRange: [1, 15], conditions: { time: ['night'] }, location: ['harbor'], trivia: 'è¦‹ãŸç›®ã¯æ€–ã„ãŒè‡†ç—…ãªæ€§æ ¼ã€‚2ã¤ã®é¡ã‚’æŒã¡ã€ã‚¨ã‚¤ãƒªã‚¢ãƒ³ã®ã‚ˆã†ã«å†…å´ã®é¡ãŒé£›ã³å‡ºã™ä»•çµ„ã¿ã€‚' },
        { id: 15, name: 'ãƒãƒ§ã‚¦ãƒãƒ³ã‚¢ãƒ³ã‚³ã‚¦', icon: 'ğŸ®', rarity: 'epic', value: 3000, chance: 3, rarityJp: 'ã‚¨ãƒ”ãƒƒã‚¯', sizeRange: [30, 100], weightRange: [2, 20], conditions: { time: ['night'] }, location: ['deepsea'], trivia: 'é ­ã®æç¯ã¯ç™ºå…‰ãƒã‚¯ãƒ†ãƒªã‚¢ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã€‚ã‚ªã‚¹ã¯ãƒ¡ã‚¹ã®1/10ã‚µã‚¤ã‚ºã§ã€ãƒ¡ã‚¹ã«å¯„ç”Ÿã—ã¦ç”Ÿãã‚‹ã€‚' },

        // æ¸¯ - æ™´ã‚Œé™å®š
        { id: 16, name: 'ãƒˆãƒ“ã‚¦ã‚ª', icon: 'ğŸŸ', rarity: 'uncommon', value: 160, chance: 17, rarityJp: 'ã‚¢ãƒ³ã‚³ãƒ¢ãƒ³', sizeRange: [15, 40], weightRange: [0.2, 1.0], conditions: { weather: ['sunny'] }, location: ['harbor'], trivia: 'èƒ¸ã³ã‚Œã‚’ç¾½ã®ã‚ˆã†ã«åºƒã’ã¦æœ€é•·400mæ»‘ç©ºã§ãã‚‹ã€‚æ™‚é€Ÿ60kmã§æ°´é¢ã‚’é£›ã³å‡ºã™é©šç•°ã®ã‚¸ãƒ£ãƒ³ãƒ—åŠ›ã€‚' },
        { id: 17, name: 'ã‚«ãƒ„ã‚ª', icon: 'ğŸŸ', rarity: 'rare', value: 550, chance: 11, rarityJp: 'ãƒ¬ã‚¢', sizeRange: [40, 100], weightRange: [2, 18], conditions: { weather: ['sunny'] }, location: ['harbor'], trivia: 'ä¸€ç”Ÿæ³³ãç¶šã‘ãªã„ã¨æ­»ã‚“ã§ã—ã¾ã†å›éŠé­šã€‚ç¸„æ–‡æ™‚ä»£ã‹ã‚‰æ—¥æœ¬äººã«é£Ÿã¹ã‚‰ã‚Œã¦ã„ãŸè¨˜éŒ²ãŒã‚ã‚‹ã€‚' },
        { id: 18, name: 'ã‚«ãƒ³ãƒ‘ãƒ', icon: 'ğŸŸ', rarity: 'rare', value: 650, chance: 9, rarityJp: 'ãƒ¬ã‚¢', sizeRange: [50, 150], weightRange: [3, 40], conditions: { weather: ['sunny'] }, location: ['harbor'], trivia: 'æ­£é¢ã‹ã‚‰è¦‹ã‚‹ã¨ã€Œå…«ã€ã®å­—ã«è¦‹ãˆã‚‹ã“ã¨ãŒåå‰ã®ç”±æ¥ã€‚é¤Šæ®–ãŒç››ã‚“ã§ã€ãƒ–ãƒªã‚ˆã‚Šè„‚ãŒå°‘ãªããƒ˜ãƒ«ã‚·ãƒ¼ã€‚' },

        // æ¸¯ - æ›‡ã‚Šé™å®š
        { id: 19, name: 'ã‚¿ãƒ©', icon: 'ğŸŸ', rarity: 'uncommon', value: 210, chance: 16, rarityJp: 'ã‚¢ãƒ³ã‚³ãƒ¢ãƒ³', sizeRange: [30, 100], weightRange: [1, 15], conditions: { weather: ['cloudy'] }, location: ['harbor'], trivia: 'ã€ŒãŸã‚‰ãµãé£Ÿã¹ã‚‹ã€ã®èªæºã¯ã“ã®é­šã®å¤§é£Ÿã„ã¶ã‚Šã‹ã‚‰ã€‚åµå·£ã¯ã€Œã‚¿ãƒ©ã‚³ã€ã¨ã—ã¦çé‡ã•ã‚Œã‚‹ã€‚' },
        { id: 20, name: 'ãƒ›ãƒƒã‚±', icon: 'ğŸŸ', rarity: 'uncommon', value: 170, chance: 19, rarityJp: 'ã‚¢ãƒ³ã‚³ãƒ¢ãƒ³', sizeRange: [25, 60], weightRange: [0.3, 1.8], conditions: { weather: ['cloudy'] }, location: ['harbor'], trivia: 'åŒ—æµ·é“ã§ã¯å®šç•ªã®é­šã€‚å¹²ç‰©ã«ã™ã‚‹ã¨æ—¨å‘³ãŒå¢—ã™ã€‚ç¾¤ã‚Œã§æ³³ãæ§˜å­ãŒåƒ§ä¾¶ã®è¡Œåˆ—ã«ä¼¼ã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ã€Œæ³•è¯ã€ã¨åä»˜ã‘ã‚‰ã‚ŒãŸã€‚' },
        { id: 21, name: 'ãƒ¡ãƒŒã‚±', icon: 'ğŸŸ', rarity: 'rare', value: 750, chance: 10, rarityJp: 'ãƒ¬ã‚¢', sizeRange: [30, 80], weightRange: [1, 12], conditions: { weather: ['cloudy'] }, location: ['harbor'], trivia: 'æ·±æµ·ã‹ã‚‰é‡£ã‚Šä¸Šã’ã‚‹ã¨ã€æ°´åœ§ã®å¤‰åŒ–ã§ç›®ãŒé£›ã³å‡ºã™ã“ã¨ã‹ã‚‰ã€Œç›®æŠœã‘ã€ã¨åä»˜ã‘ã‚‰ã‚ŒãŸã€‚é«˜ç´šé­šã¨ã—ã¦çŸ¥ã‚‰ã‚Œã‚‹ã€‚' },

        // å· - é›¨é™å®š
        { id: 22, name: 'ã‚¦ãƒŠã‚®', icon: 'ğŸ', rarity: 'rare', value: 900, chance: 12, rarityJp: 'ãƒ¬ã‚¢', sizeRange: [40, 150], weightRange: [0.5, 5], conditions: { weather: ['rainy'] }, location: ['river'], trivia: 'ç”£åµå ´æ‰€ã¯è¬ã«åŒ…ã¾ã‚Œã¦ã„ãŸãŒã€ãƒãƒªã‚¢ãƒŠæµ·æºä»˜è¿‘ã¨åˆ¤æ˜ã€‚å·ã§è‚²ã¡ã€ç”£åµã®ãŸã‚æ•°åƒkmæ³³ã„ã§æµ·ã¸æˆ»ã‚‹ã€‚' },
        { id: 23, name: 'ãƒŠãƒã‚º', icon: 'ğŸŸ', rarity: 'uncommon', value: 230, chance: 20, rarityJp: 'ã‚¢ãƒ³ã‚³ãƒ¢ãƒ³', sizeRange: [30, 80], weightRange: [0.5, 6], conditions: { weather: ['rainy'] }, location: ['river'], trivia: 'åœ°éœ‡ã‚’äºˆçŸ¥ã™ã‚‹ã¨è¨€ã‚ã‚Œã‚‹ãŒç§‘å­¦çš„æ ¹æ‹ ã¯è–„ã„ã€‚ãƒ’ã‚²ã«ã¯å‘³ã‚’æ„Ÿã˜ã‚‹å™¨å®˜ãŒã‚ã‚Šã€æš—é—‡ã§ã‚‚ç²ç‰©ã‚’æ¢ã›ã‚‹ã€‚' },
        { id: 24, name: 'ãƒªãƒ¥ã‚¦ã‚°ã‚¦ãƒãƒ„ã‚«ã‚¤', icon: 'ğŸ²', rarity: 'epic', value: 5000, chance: 2, rarityJp: 'ã‚¨ãƒ”ãƒƒã‚¯', sizeRange: [200, 800], weightRange: [20, 250], conditions: { weather: ['rainy'] }, location: ['deepsea'], trivia: 'æœ€å¤§11mã«é”ã™ã‚‹ä¸–ç•Œæœ€é•·ã®ç¡¬éª¨é­šã€‚äººé­šã®ãƒ¢ãƒ‡ãƒ«ã¨ã‚‚ã€‚æµœã«æ‰“ã¡ä¸Šã’ã‚‰ã‚Œã‚‹ã¨ã€Œåœ°éœ‡ã®å‰å…†ã€ã¨æã‚Œã‚‰ã‚ŒãŸã€‚' },

        // æ·±æµ· - æœ+æ™´ã‚Œ
        { id: 25, name: 'ã‚­ãƒ³ãƒ¡ãƒ€ã‚¤', icon: 'ğŸŸ', rarity: 'rare', value: 850, chance: 7, rarityJp: 'ãƒ¬ã‚¢', sizeRange: [20, 50], weightRange: [0.5, 3], conditions: { time: ['morning'], weather: ['sunny'] }, location: ['deepsea'], trivia: 'å¤§ããªé‡‘è‰²ã®ç›®ãŒç‰¹å¾´ã€‚æ·±æµ·200-800mã«ç”Ÿæ¯ã—ã€ä½æ¸©ã§ã‚‚æ´»å‹•ã§ãã‚‹ç‰¹æ®Šãªé…µç´ ã‚’æŒã¤ã€‚' },

        // æ¸¯ - æ˜¼+æ™´ã‚Œ
        { id: 26, name: 'ãƒãƒ€ã‚¤', icon: 'ğŸŸ', rarity: 'rare', value: 800, chance: 10, rarityJp: 'ãƒ¬ã‚¢', sizeRange: [30, 80], weightRange: [1, 8], conditions: { time: ['day'], weather: ['sunny'] }, location: ['harbor'], trivia: 'ã€Œã‚ã§ãŸã„ã€ã®èªå‘‚åˆã‚ã›ã§ç¸èµ·ç‰©ã«ã€‚40å¹´ä»¥ä¸Šç”Ÿãã‚‹å€‹ä½“ã‚‚ã‚ã‚Šã€å¹´ã‚’å–ã‚‹ã»ã©ç¾ã—ã„ç´…è‰²ã«ãªã‚‹ã€‚' },
        { id: 27, name: 'ã‚¯ãƒ­ãƒã‚°ãƒ­', icon: 'ğŸŸ', rarity: 'epic', value: 3500, chance: 4, rarityJp: 'ã‚¨ãƒ”ãƒƒã‚¯', sizeRange: [100, 300], weightRange: [50, 400], conditions: { time: ['day'], weather: ['sunny'] }, location: ['harbor'], trivia: 'æ™‚é€Ÿ160kmã§æ³³ã’ã‚‹æµ·ã®ã‚¹ãƒ—ãƒªãƒ³ã‚¿ãƒ¼ã€‚ä½“æ¸©ã‚’æµ·æ°´ã‚ˆã‚Šé«˜ãä¿ã¦ã‚‹æ¸©è¡€é­šã§ã€å¯¿å¸ãƒã‚¿ã®ç‹æ§˜ã€‚' },

        // å· - å¤•æ–¹+æ›‡ã‚Š
        { id: 28, name: 'ã‚µã‚±', icon: 'ğŸ£', rarity: 'rare', value: 600, chance: 11, rarityJp: 'ãƒ¬ã‚¢', sizeRange: [40, 100], weightRange: [2, 10], conditions: { time: ['evening'], weather: ['cloudy'] }, location: ['river'], trivia: 'ç”Ÿã¾ã‚ŒãŸå·ã‚’æ•°å¹´å¾Œã«åŒ‚ã„ã§è­˜åˆ¥ã—ã¦æˆ»ã£ã¦ãã‚‹ã€‚ç”£åµå¾Œã¯åŠ›å°½ãã¦æ­»ã¬ã€å‘½ã‚’ã‹ã‘ãŸæ—…ã‚’ã™ã‚‹é­šã€‚' },

        // æ·±æµ· - å¤œ+é›¨
        { id: 29, name: 'ã‚ªã‚ªã‚°ãƒãƒœãƒ¤', icon: 'ğŸ¦‘', rarity: 'epic', value: 4000, chance: 2, rarityJp: 'ã‚¨ãƒ”ãƒƒã‚¯', sizeRange: [10, 30], weightRange: [0.1, 1], conditions: { time: ['night'], weather: ['rainy'] }, location: ['deepsea'], trivia: 'é­šã§ã¯ãªããƒ›ãƒ¤ã®ä»²é–“ã€‚é€æ˜ãªä½“ã§ã€å¤§ããªå£ã§ç²ç‰©ã‚’ä¸¸å‘‘ã¿ã«ã™ã‚‹ã€‚æ·±æµ·2000mä»¥ä¸Šã«ç”Ÿæ¯ã€‚' },

        // ãƒ¬ã‚¸ã‚§ãƒ³ãƒ€ãƒªãƒ¼
        { id: 30, name: 'ã‚·ãƒ¼ãƒ©ã‚«ãƒ³ã‚¹', icon: 'ğŸ‰', rarity: 'legendary', value: 15000, chance: 1, rarityJp: 'ãƒ¬ã‚¸ã‚§ãƒ³ãƒ€ãƒªãƒ¼', sizeRange: [120, 200], weightRange: [30, 100], conditions: { time: ['night'], weather: ['rainy'] }, location: ['deepsea'], trivia: 'ã€Œç”ŸããŸåŒ–çŸ³ã€ã¨ã—ã¦æœ‰åã€‚6500ä¸‡å¹´å‰ã«çµ¶æ»…ã—ãŸã¨æ€ã‚ã‚Œã¦ã„ãŸãŒã€1938å¹´ã«ç”ŸããŸå€‹ä½“ãŒç™ºè¦‹ã•ã‚Œä¸–ç•Œã‚’é©šã‹ã›ãŸã€‚' },
        { id: 31, name: 'ãƒ¡ã‚¬ãƒã‚¦ã‚¹ã‚¶ãƒ¡', icon: 'ğŸ¦ˆ', rarity: 'legendary', value: 20000, chance: 0.5, rarityJp: 'ãƒ¬ã‚¸ã‚§ãƒ³ãƒ€ãƒªãƒ¼', sizeRange: [300, 600], weightRange: [500, 1200], conditions: { time: ['night'] }, location: ['deepsea'], trivia: '1976å¹´ã«åˆã‚ã¦ç™ºè¦‹ã•ã‚ŒãŸå¹»ã®ã‚µãƒ¡ã€‚å·¨å¤§ãªå£ã§ãƒ—ãƒ©ãƒ³ã‚¯ãƒˆãƒ³ã‚’æ¿¾ã—å–ã£ã¦é£Ÿã¹ã‚‹ã€‚ä¸–ç•Œã§100ä¾‹ã»ã©ã—ã‹ç›®æ’ƒä¾‹ãŒãªã„ã€‚' },
        { id: 32, name: 'ãƒ›ã‚ªã‚¸ãƒ­ã‚¶ãƒ¡', icon: 'ğŸ¦ˆ', rarity: 'legendary', value: 18000, chance: 0.8, rarityJp: 'ãƒ¬ã‚¸ã‚§ãƒ³ãƒ€ãƒªãƒ¼', sizeRange: [200, 600], weightRange: [200, 2000], conditions: { time: ['day'], weather: ['sunny'] }, location: ['harbor'], trivia: 'æ˜ ç”»ã‚¸ãƒ§ãƒ¼ã‚ºã®ãƒ¢ãƒ‡ãƒ«ã€‚å®Ÿã¯äººé–“ã‚’å¥½ã‚“ã§è¥²ã†ã‚ã‘ã§ã¯ãªãã€ã‚µãƒ¼ãƒ•ã‚¡ãƒ¼ã‚’ã‚¢ã‚¶ãƒ©ã‚·ã¨é–“é•ãˆã‚‹ã“ã¨ãŒå¤šã„ã€‚' },

        // ãƒœãƒ¼ãƒŠã‚¹é­š
        { id: 33, name: 'ãƒãƒªã‚»ãƒ³ãƒœãƒ³', icon: 'ğŸ¡', rarity: 'rare', value: 600, chance: 8, rarityJp: 'ãƒ¬ã‚¢', sizeRange: [15, 40], weightRange: [0.5, 2.5], conditions: { time: ['day'], weather: ['rainy'] }, location: ['harbor'], trivia: 'åå‰ã¯åƒæœ¬ã ãŒã€å®Ÿéš›ã®ãƒˆã‚²ã¯350-400æœ¬ç¨‹åº¦ã€‚è†¨ã‚‰ã‚€ã¨ãƒˆã‚²ãŒç«‹ã¤ã€‚ãƒ•ã‚°ã®ä»²é–“ã ãŒæ¯’ã¯å¼±ã„ã€‚' },
        { id: 34, name: 'ã‚«ã‚¸ã‚­', icon: 'ğŸ—¡ï¸', rarity: 'epic', value: 2500, chance: 5, rarityJp: 'ã‚¨ãƒ”ãƒƒã‚¯', sizeRange: [150, 400], weightRange: [50, 500], conditions: { time: ['day'] }, location: ['harbor'], trivia: 'å»ï¼ˆãã¡ã°ã—ï¼‰ãŒæ§ã®ã‚ˆã†ã«ä¼¸ã³ã¦ã„ã‚‹ã€‚æ™‚é€Ÿ110kmã§æ³³ãã€èˆ¹ã®åº•ã‚’çªãç ´ã£ãŸè¨˜éŒ²ã‚‚ã‚ã‚‹æµ·ã®æˆ¦å£«ã€‚' },
        { id: 35, name: 'ãƒãƒ³ãƒœã‚¦', icon: 'ğŸ¡', rarity: 'epic', value: 2800, chance: 4, rarityJp: 'ã‚¨ãƒ”ãƒƒã‚¯', sizeRange: [100, 300], weightRange: [200, 2300], conditions: { weather: ['sunny'] }, location: ['harbor'], trivia: 'ä¸€åº¦ã«3å„„å€‹ã‚‚ã®åµã‚’ç”£ã‚€ä¸–ç•Œè¨˜éŒ²ä¿æŒè€…ã€‚ã€Œã™ãæ­»ã¬ã€ã¨ã„ã†å™‚ã¯å˜˜ã§ã€å®Ÿã¯æ„å¤–ã¨ä¸ˆå¤«ãªé­šã€‚' },

        // å·ã®é­š
        { id: 36, name: 'ã‚³ã‚¤', icon: 'ğŸŸ', rarity: 'common', value: 90, chance: 35, rarityJp: 'ã‚³ãƒ¢ãƒ³', sizeRange: [20, 80], weightRange: [0.5, 8], conditions: {}, location: ['river'], trivia: '100å¹´ä»¥ä¸Šç”Ÿãã‚‹å€‹ä½“ã‚‚ã€‚ã€Œæ»ã‚’ç™»ã£ã¦é¾ã«ãªã‚‹ã€ã¨ã„ã†ä¼èª¬ã‹ã‚‰ã€ç«‹èº«å‡ºä¸–ã®è±¡å¾´ã¨ã•ã‚Œã‚‹ç¸èµ·ç‰©ã€‚' },
        { id: 37, name: 'ãƒ•ãƒŠ', icon: 'ğŸŸ', rarity: 'common', value: 60, chance: 40, rarityJp: 'ã‚³ãƒ¢ãƒ³', sizeRange: [10, 30], weightRange: [0.1, 0.8], conditions: {}, location: ['river'], trivia: 'ã‚ªã‚¹ãŒã„ãªãã¦ã‚‚ç¹æ®–ã§ãã‚‹ç‰¹æ®Šãªç¨®ï¼ˆã‚®ãƒ³ãƒ–ãƒŠï¼‰ãŒã„ã‚‹ã€‚ã‚¯ãƒ­ãƒ¼ãƒ³ã§å¢—ãˆã‚‹çã—ã„è„Šæ¤å‹•ç‰©ã€‚' },
        { id: 38, name: 'ãƒ‹ã‚¸ãƒã‚¹', icon: 'ğŸŸ', rarity: 'uncommon', value: 300, chance: 18, rarityJp: 'ã‚¢ãƒ³ã‚³ãƒ¢ãƒ³', sizeRange: [20, 60], weightRange: [0.3, 3], conditions: {}, location: ['river', 'lake'], trivia: 'åŒ—ç±³åŸç”£ã§ã€æ˜æ²»æ™‚ä»£ã«æ—¥æœ¬ã«å°å…¥ã•ã‚ŒãŸå¤–æ¥ç¨®ã€‚ä½“å´ã®è™¹è‰²ã®å¸¯ãŒç¾ã—ãã€é‡£ã‚Šã®å¯¾è±¡é­šã¨ã—ã¦äººæ°—ã€‚' },
        { id: 43, name: 'ã‚¢ãƒ¦', icon: 'ğŸŸ', rarity: 'uncommon', value: 280, chance: 17, rarityJp: 'ã‚¢ãƒ³ã‚³ãƒ¢ãƒ³', sizeRange: [15, 30], weightRange: [0.05, 0.2], conditions: {}, location: ['river'], trivia: 'ã‚¹ã‚¤ã‚«ã®ã‚ˆã†ãªç‹¬ç‰¹ã®é¦™ã‚ŠãŒã™ã‚‹ã€Œé¦™é­šã€ã€‚ç¸„å¼µã‚Šæ„è­˜ãŒå¼·ãã€ä¾µå…¥è€…ã‚’ä½“å½“ãŸã‚Šã§è¿½ã„æ‰•ã†æ€§æ ¼ã€‚' },
        { id: 44, name: 'ãƒ¤ãƒãƒ¡', icon: 'ğŸŸ', rarity: 'uncommon', value: 320, chance: 15, rarityJp: 'ã‚¢ãƒ³ã‚³ãƒ¢ãƒ³', sizeRange: [15, 35], weightRange: [0.1, 0.4], conditions: {}, location: ['river'], trivia: 'æ¸“æµã®å¥³ç‹ã¨å‘¼ã°ã‚Œã‚‹ç¾ã—ã„é­šã€‚å®Ÿã¯ã‚µã‚¯ãƒ©ãƒã‚¹ã®é™¸å°å‹ã§ã€æµ·ã«ä¸‹ã‚‹å€‹ä½“ã¯å¤§ããæˆé•·ã™ã‚‹ã€‚' },
        { id: 45, name: 'ã‚¤ãƒ¯ãƒŠ', icon: 'ğŸŸ', rarity: 'uncommon', value: 310, chance: 16, rarityJp: 'ã‚¢ãƒ³ã‚³ãƒ¢ãƒ³', sizeRange: [15, 40], weightRange: [0.1, 0.6], conditions: {}, location: ['river'], trivia: 'æ—¥æœ¬ã§æœ€ã‚‚ä¸ŠæµåŸŸã«ç”Ÿæ¯ã™ã‚‹é­šã€‚æ°·æ²³æœŸã®ç”Ÿãæ®‹ã‚Šã§ã€å†·ãŸã„æ°´ã‚’å¥½ã‚€ã€‚50å¹´ä»¥ä¸Šç”Ÿãã‚‹å€‹ä½“ã‚‚ã€‚' },
        { id: 46, name: 'ãƒ‰ã‚¸ãƒ§ã‚¦', icon: 'ğŸŸ', rarity: 'common', value: 75, chance: 30, rarityJp: 'ã‚³ãƒ¢ãƒ³', sizeRange: [10, 20], weightRange: [0.02, 0.1], conditions: {}, location: ['river'], trivia: 'è…¸ã§å‘¼å¸ã§ãã‚‹çã—ã„é­šã€‚ç”°ã‚“ã¼ã®æ³¥ã®ä¸­ã§ç”Ÿãå»¶ã³ã‚‰ã‚Œã‚‹é©šç•°ã®ç”Ÿå‘½åŠ›ã€‚æŸ³å·é‹ã¯æ±Ÿæˆ¸ã®éƒ·åœŸæ–™ç†ã€‚' },

        // æ¹–ã®é­š
        { id: 39, name: 'ãƒ–ãƒ©ãƒƒã‚¯ãƒã‚¹', icon: 'ğŸŸ', rarity: 'uncommon', value: 350, chance: 20, rarityJp: 'ã‚¢ãƒ³ã‚³ãƒ¢ãƒ³', sizeRange: [25, 70], weightRange: [0.5, 6], conditions: {}, location: ['lake'], trivia: 'åŒ—ç±³åŸç”£ã®å¤–æ¥ç¨®ã€‚é‡£ã‚Šã®å¯¾è±¡é­šã¨ã—ã¦äººæ°—ã ãŒã€åœ¨æ¥ç¨®ã‚’é£Ÿã¹ã¦ã—ã¾ã†ç”Ÿæ…‹ç³»ã®è„…å¨ã§ã‚‚ã‚ã‚‹ã€‚' },
        { id: 40, name: 'ã‚¤ãƒˆã‚¦', icon: 'ğŸŸ', rarity: 'rare', value: 1200, chance: 8, rarityJp: 'ãƒ¬ã‚¢', sizeRange: [60, 150], weightRange: [5, 30], conditions: {}, location: ['lake'], trivia: 'æ—¥æœ¬æœ€å¤§ã®æ·¡æ°´é­šã€‚1.5mã‚’è¶…ãˆã‚‹å€‹ä½“ã‚‚ã€‚çµ¶æ»…å±æƒ§ç¨®ã§ã€å¹»ã®é­šã¨å‘¼ã°ã‚Œã‚‹åŒ—æµ·é“ã®å®ã€‚' },
        { id: 41, name: 'ãƒ¯ã‚«ã‚µã‚®', icon: 'ğŸŸ', rarity: 'common', value: 70, chance: 30, rarityJp: 'ã‚³ãƒ¢ãƒ³', sizeRange: [5, 15], weightRange: [0.01, 0.05], conditions: {}, location: ['lake'], trivia: 'æ°·ã«ç©´ã‚’é–‹ã‘ã¦é‡£ã‚‹ã€Œç©´é‡£ã‚Šã€ã§æœ‰åã€‚éª¨ã”ã¨é£Ÿã¹ã‚‰ã‚Œã‚‹å°é­šã§ã€å¤©ã·ã‚‰ã«ã™ã‚‹ã¨çµ¶å“ã€‚' },
        { id: 42, name: 'ãƒ“ãƒ¯ã‚³ã‚ªã‚ªãƒŠãƒã‚º', icon: 'ğŸŸ', rarity: 'epic', value: 4500, chance: 3, rarityJp: 'ã‚¨ãƒ”ãƒƒã‚¯', sizeRange: [100, 200], weightRange: [10, 50], conditions: {}, location: ['lake'], trivia: 'çµç¶æ¹–ã«ã®ã¿ç”Ÿæ¯ã™ã‚‹å›ºæœ‰ç¨®ã€‚æœ€å¤§140cmã«é”ã™ã‚‹æ—¥æœ¬æœ€å¤§ã®ãƒŠãƒã‚ºã€‚çµ¶æ»…å±æƒ§ç¨®ã§ã€æ•ç²ã¯ç¦æ­¢ã•ã‚Œã¦ã„ã‚‹ã€‚' },
        { id: 47, name: 'ãƒ˜ãƒ©ãƒ–ãƒŠ', icon: 'ğŸŸ', rarity: 'uncommon', value: 150, chance: 22, rarityJp: 'ã‚¢ãƒ³ã‚³ãƒ¢ãƒ³', sizeRange: [20, 50], weightRange: [0.3, 3], conditions: {}, location: ['lake'], trivia: 'ã‚²ãƒ³ã‚´ãƒ­ã‚¦ãƒ–ãƒŠã¨ã‚‚å‘¼ã°ã‚Œã‚‹ã€‚é‡£ã‚Šå €ã®å®šç•ªã§ã€å¼•ãã®å¼·ã•ã‹ã‚‰ã€Œé‡£ã‚Šã®æ¥½ã—ã•ã‚’æ•™ãˆã¦ãã‚Œã‚‹é­šã€ã¨ã—ã¦äººæ°—ã€‚' },

        // æ·±æµ·ã®é­šï¼ˆè¿½åŠ ï¼‰
        { id: 48, name: 'ãƒ€ã‚¤ã‚ªã‚¦ã‚¤ã‚«', icon: 'ğŸ¦‘', rarity: 'epic', value: 5500, chance: 2, rarityJp: 'ã‚¨ãƒ”ãƒƒã‚¯', sizeRange: [500, 1300], weightRange: [150, 500], conditions: {}, location: ['deepsea'], trivia: 'ä¸–ç•Œæœ€å¤§ã®ç„¡è„Šæ¤å‹•ç‰©ã€‚ç›®ç‰ã¯ãƒã‚¹ã‚±ãƒƒãƒˆãƒœãƒ¼ãƒ«å¤§ã€‚ãƒãƒƒã‚³ã‚¦ã‚¯ã‚¸ãƒ©ã®å¥½ç‰©ã§ã€æˆ¦ã„ã®è·¡ãŒæ®‹ã‚‹ã“ã¨ã‚‚ã€‚' },
        { id: 49, name: 'ãƒ‡ãƒ¡ãƒ‹ã‚®ã‚¹', icon: 'ğŸŸ', rarity: 'epic', value: 4200, chance: 2.5, rarityJp: 'ã‚¨ãƒ”ãƒƒã‚¯', sizeRange: [10, 20], weightRange: [0.05, 0.15], conditions: {}, location: ['deepsea'], trivia: 'é ­ãŒé€æ˜ãªãƒ‰ãƒ¼ãƒ çŠ¶ã§ã€ä¸­ã«ç·‘è‰²ã®ç›®ãŒæµ®ã‹ã‚“ã§ã„ã‚‹ã€‚ä¸Šã‚’è¦‹ä¸Šã’ã¦ç²ç‰©ã®ã‚·ãƒ«ã‚¨ãƒƒãƒˆã‚’æ¢ã™æ·±æµ·ã®å¥‡é­šã€‚' },
        { id: 50, name: 'ãƒ©ãƒ–ã‚«', icon: 'ğŸ¦ˆ', rarity: 'epic', value: 3800, chance: 3, rarityJp: 'ã‚¨ãƒ”ãƒƒã‚¯', sizeRange: [120, 200], weightRange: [20, 90], conditions: {}, location: ['deepsea'], trivia: 'ã€Œç”ŸããŸåŒ–çŸ³ã€ã¨å‘¼ã°ã‚Œã‚‹åŸå§‹çš„ãªã‚µãƒ¡ã€‚3å„„å¹´å‰ã‹ã‚‰ã»ã¼å§¿ã‚’å¤‰ãˆã¦ã„ãªã„ã€‚ã‚¨ãƒ©ãŒ6å¯¾ã‚‚ã‚ã‚‹çã—ã„æ§‹é€ ã€‚' },
        { id: 51, name: 'ãƒŸãƒ„ã‚¯ãƒªã‚¶ãƒ¡', icon: 'ğŸ¦ˆ', rarity: 'epic', value: 4100, chance: 2.5, rarityJp: 'ã‚¨ãƒ”ãƒƒã‚¯', sizeRange: [200, 400], weightRange: [80, 210], conditions: {}, location: ['deepsea'], trivia: 'ã‚´ãƒ–ãƒªãƒ³ã‚·ãƒ£ãƒ¼ã‚¯ã¨ã‚‚å‘¼ã°ã‚Œã‚‹ã€‚é¡ãŒå‰æ–¹ã«é£›ã³å‡ºã™ç‹¬ç‰¹ã®æ•é£Ÿæ–¹æ³•ã‚’æŒã¤ã€‚ãƒ”ãƒ³ã‚¯è‰²ã®ä½“ãŒç‰¹å¾´çš„ã€‚' },

        // æ¸¯ã®é­šï¼ˆè¿½åŠ ï¼‰
        { id: 52, name: 'ã‚µãƒ¯ãƒ©', icon: 'ğŸŸ', rarity: 'uncommon', value: 380, chance: 16, rarityJp: 'ã‚¢ãƒ³ã‚³ãƒ¢ãƒ³', sizeRange: [40, 110], weightRange: [1, 12], conditions: {}, location: ['harbor'], trivia: 'ã€Œé°†ã€ã®å­—ã®é€šã‚Šæ˜¥ãŒæ—¬ã€‚ç´°é•·ã„é­šä½“ã‹ã‚‰ã€Œç‹­ã„è…¹ã€ãŒåå‰ã®ç”±æ¥ã€‚é«˜é€Ÿã§æ³³ãã€æ™‚é€Ÿ70kmã«é”ã™ã‚‹ã€‚' },
        { id: 53, name: 'ã‚¢ã‚¤ãƒŠãƒ¡', icon: 'ğŸŸ', rarity: 'uncommon', value: 240, chance: 18, rarityJp: 'ã‚¢ãƒ³ã‚³ãƒ¢ãƒ³', sizeRange: [25, 50], weightRange: [0.5, 2.5], conditions: {}, location: ['harbor'], trivia: 'æ„›å¬Œã®ã‚ã‚‹é¡”ç«‹ã¡ã‹ã‚‰ã€Œé®é­šå¥³ã€ã¨æ›¸ãã€‚å®Ÿã¯ä¸€å¤«å¤šå¦»åˆ¶ã§ã€ã‚ªã‚¹ãŒåµã‚’å®ˆã‚‹çã—ã„é­šã€‚' },
        { id: 54, name: 'ã‚­ã‚¹', icon: 'ğŸŸ', rarity: 'common', value: 120, chance: 28, rarityJp: 'ã‚³ãƒ¢ãƒ³', sizeRange: [15, 30], weightRange: [0.1, 0.3], conditions: {}, location: ['harbor'], trivia: 'ã€Œæµ·ã®è²´å©¦äººã€ã¨å‘¼ã°ã‚Œã‚‹ä¸Šå“ãªå‘³ã€‚ç ‚åœ°ã«ç”Ÿæ¯ã—ã€å¤©ã·ã‚‰ã«ã™ã‚‹ã¨çµ¶å“ã€‚æŠ•ã’é‡£ã‚Šã®å®šç•ªã‚¿ãƒ¼ã‚²ãƒƒãƒˆã€‚' },
        { id: 55, name: 'ãƒ•ã‚°', icon: 'ğŸ¡', rarity: 'rare', value: 850, chance: 7, rarityJp: 'ãƒ¬ã‚¢', sizeRange: [20, 50], weightRange: [0.5, 3], conditions: {}, location: ['harbor'], trivia: 'æ¯’ã‚’æŒã£ã¦ç”Ÿã¾ã‚Œã‚‹ã®ã§ã¯ãªãã€é¤Œã‹ã‚‰è“„ç©ã™ã‚‹ã€‚ãƒ‰ã‚¢ã®éµã‚’é–‹ã‘ãŸã‚Šè¿·è·¯ã‚’è§£ã„ãŸã‚Šã™ã‚‹çŸ¥èƒ½ã®é«˜ã•ã€‚' },
        { id: 56, name: 'ã‚¿ã‚³', icon: 'ğŸ™', rarity: 'uncommon', value: 420, chance: 15, rarityJp: 'ã‚¢ãƒ³ã‚³ãƒ¢ãƒ³', sizeRange: [30, 100], weightRange: [1, 15], conditions: {}, location: ['harbor'], trivia: 'å¿ƒè‡“ãŒ3ã¤ã‚ã‚Šã€è¡€æ¶²ã¯é’ã„ã€‚è„³ã¯9ã¤ã‚ã‚Šã€8æœ¬ã®è¶³ãã‚Œãã‚Œã«åˆ†æ•£ã—ã¦ã„ã‚‹å¤©æ‰çš„ãªæ§‹é€ ã€‚' },
        { id: 57, name: 'ã‚¨ã‚¤', icon: 'ğŸŸ', rarity: 'uncommon', value: 310, chance: 14, rarityJp: 'ã‚¢ãƒ³ã‚³ãƒ¢ãƒ³', sizeRange: [50, 150], weightRange: [5, 50], conditions: {}, location: ['harbor'], trivia: 'å°»å°¾ã«æ¯’é‡ã‚’æŒã¤ã€‚å®Ÿã¯ã‚µãƒ¡ã®ä»²é–“ã§ã€è»Ÿéª¨é­šé¡ã€‚æµ·åº•ã®ç ‚ã«æ½œã£ã¦ç²ç‰©ã‚’å¾…ã¡ä¼ã›ã‚‹ã€‚' }
    ];

    const GAME_STATE = { IDLE: 'idle', CHARGING: 'charging', FLYING: 'flying', WAITING: 'waiting', BITE: 'bite', REELING: 'reeling' };

    class FishingExperience {
        constructor() {
            this.container = document.getElementById('canvas-container');
            this.btn = document.getElementById('action-btn');
            this.btnText = document.getElementById('btn-text');
            this.powerMeter = document.getElementById('power-meter');
            this.powerFill = document.getElementById('power-fill');
            this.wrapper = document.getElementById('game-wrapper');

            this.state = GAME_STATE.IDLE;
            this.money = parseInt(localStorage.getItem('fishingMoney') || '0');
            this.caughtCount = parseInt(localStorage.getItem('fishingCaughtCount') || '0');
            this.collection = new Set();
            this.charge = 0;
            this.mousePos = { x: 0, y: 0 };
            this.timeOfDay = 'day';
            this.weather = 'sunny';
            this.currentLocation = 'harbor';
            this.unlockedLocations = JSON.parse(localStorage.getItem('fishingUnlockedLocations') || '["harbor"]');
            this.maxRecords = JSON.parse(localStorage.getItem('fishingMaxRecords') || '{}');

            this.initThree();
            this.initEvents();
            this.animate();
        }

        initThree() {
            this.scene = new THREE.Scene();
            this.scene.background = new THREE.Color(0x020617);
            this.scene.fog = new THREE.FogExp2(0x0a192f, 0.025);

            this.camera = new THREE.PerspectiveCamera(60, this.container.clientWidth / this.container.clientHeight, 0.1, 1000);
            this.camera.position.set(0, 5, 12);
            this.camera.lookAt(0, 2, 0);

            this.renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            this.renderer.setSize(this.container.clientWidth, this.container.clientHeight);
            this.renderer.setPixelRatio(window.devicePixelRatio);
            this.container.appendChild(this.renderer.domElement);

            this.ambientLight = new THREE.AmbientLight(0x4040ff, 0.6);
            this.scene.add(this.ambientLight);
            this.sunLight = new THREE.DirectionalLight(0xffaa00, 1.0);
            this.sunLight.position.set(10, 20, 10);
            this.scene.add(this.sunLight);

            const seaGeo = new THREE.PlaneGeometry(200, 200, 100, 100);
            this.seaMat = new THREE.MeshPhongMaterial({ color: 0x0ea5e9, transparent: true, opacity: 0.8, shininess: 80, specular: 0xffffff });
            this.sea = new THREE.Mesh(seaGeo, this.seaMat);
            this.sea.rotation.x = -Math.PI / 2;
            this.scene.add(this.sea);

            const floor = new THREE.Mesh(new THREE.PlaneGeometry(200, 200), new THREE.MeshBasicMaterial({ color: 0x040d1a }));
            floor.rotation.x = -Math.PI / 2;
            floor.position.y = -10;
            this.scene.add(floor);

            // 3D Rodï¼ˆæ”¹å–„ç‰ˆï¼‰
            this.rodGroup = new THREE.Group();

            // ãƒãƒ³ãƒ‰ãƒ«ï¼ˆã‚°ãƒªãƒƒãƒ—éƒ¨åˆ†ï¼‰- ã‚ˆã‚Šå¤ªãã€æ˜ã‚‹ã
            const rodHandleGeo = new THREE.CylinderGeometry(0.15, 0.18, 2, 12);
            const handleMat = new THREE.MeshPhongMaterial({
                color: 0x8B4513,
                shininess: 30,
                specular: 0x222222
            });
            const handle = new THREE.Mesh(rodHandleGeo, handleMat);
            handle.position.y = 1;
            this.rodGroup.add(handle);

            // ç«¿ã®æœ¬ä½“ï¼ˆãƒ¡ã‚¤ãƒ³ãƒ­ãƒƒãƒ‰ï¼‰- ã‚ˆã‚Šå¤ªãã€ç›®ç«‹ã¤è‰²
            const mainRodGeo = new THREE.CylinderGeometry(0.08, 0.15, 4, 12);
            const mainRodMat = new THREE.MeshPhongMaterial({
                color: 0xCD853F,
                shininess: 50,
                specular: 0x444444
            });
            const mainRod = new THREE.Mesh(mainRodGeo, mainRodMat);
            mainRod.position.y = 4;
            this.rodGroup.add(mainRod);

            // ç«¿ã®å…ˆç«¯éƒ¨åˆ† - ç´°ãã€ã—ãªã‚„ã‹ã«
            const tipGeo = new THREE.CylinderGeometry(0.03, 0.08, 3, 12);
            const tipMat = new THREE.MeshPhongMaterial({
                color: 0xD2691E,
                shininess: 60,
                specular: 0x666666
            });
            const tip = new THREE.Mesh(tipGeo, tipMat);
            tip.position.y = 7.5;
            this.rodGroup.add(tip);

            // ãƒªãƒ¼ãƒ«ã®è£…é£¾
            const reelGeo = new THREE.CylinderGeometry(0.25, 0.25, 0.3, 16);
            const reelMat = new THREE.MeshPhongMaterial({
                color: 0x696969,
                metalness: 0.8,
                shininess: 100,
                specular: 0xaaaaaa
            });
            const reel = new THREE.Mesh(reelGeo, reelMat);
            reel.position.y = 2;
            reel.rotation.z = Math.PI / 2;
            this.rodGroup.add(reel);

            this.rodGroup.position.set(-3, 0, 6);
            this.rodGroup.rotation.set(0.3, 0.4, 0.15);
            this.rodGroup.scale.set(0.5, 0.5, 0.5); // åŠåˆ†ã®ã‚µã‚¤ã‚ºã«ç¸®å°
            this.scene.add(this.rodGroup);

            this.bobberMesh = new THREE.Mesh(new THREE.SphereGeometry(0.2, 12, 12), new THREE.MeshPhongMaterial({ color: 0x4cc9f0, emissive: 0x4cc9f0, emissiveIntensity: 0.4 }));
            this.bobberMesh.visible = false;
            this.scene.add(this.bobberMesh);

            this.fishingLine = new THREE.Line(new THREE.BufferGeometry(), new THREE.LineBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.4 }));
            this.fishingLine.visible = false;
            this.scene.add(this.fishingLine);

            // 3D Fish Mesh
            this.fishGroup = new THREE.Group();
            const fishBodyGeo = new THREE.SphereGeometry(0.4, 16, 12);
            fishBodyGeo.scale(1.5, 0.8, 0.8);
            const fishMat = new THREE.MeshPhongMaterial({ color: 0x4fc3f7, shininess: 80, specular: 0xffffff });
            const fishBody = new THREE.Mesh(fishBodyGeo, fishMat);
            this.fishGroup.add(fishBody);

            const tailGeo = new THREE.ConeGeometry(0.3, 0.5, 8);
            tailGeo.rotateZ(Math.PI / 2);
            const tail = new THREE.Mesh(tailGeo, fishMat);
            tail.position.set(-0.6, 0, 0);
            this.fishGroup.add(tail);

            const finGeo = new THREE.ConeGeometry(0.15, 0.3, 6);
            finGeo.rotateZ(Math.PI / 2);
            const topFin = new THREE.Mesh(finGeo, new THREE.MeshPhongMaterial({ color: 0x0288d1 }));
            topFin.position.set(0.1, 0.4, 0);
            topFin.rotation.z = -Math.PI / 2;
            this.fishGroup.add(topFin);

            const eyeGeo = new THREE.SphereGeometry(0.08, 8, 8);
            const eyeMat = new THREE.MeshPhongMaterial({ color: 0x000000 });
            const eye1 = new THREE.Mesh(eyeGeo, eyeMat);
            eye1.position.set(0.4, 0.15, 0.2);
            this.fishGroup.add(eye1);
            const eye2 = new THREE.Mesh(eyeGeo, eyeMat);
            eye2.position.set(0.4, 0.15, -0.2);
            this.fishGroup.add(eye2);

            this.fishGroup.visible = false;
            this.scene.add(this.fishGroup);

            const pCount = 800;
            const pGeo = new THREE.BufferGeometry();
            const pPos = new Float32Array(pCount * 3);
            for(let i=0; i<pCount*3; i++) pPos[i] = (Math.random()-0.5)*80;
            pGeo.setAttribute('position', new THREE.BufferAttribute(pPos, 3));
            this.bubbles = new THREE.Points(pGeo, new THREE.PointsMaterial({ color: 0xffffff, size: 0.04, transparent: true, opacity: 0.3 }));
            this.scene.add(this.bubbles);

            // Fish Shadows (swimming in water during waiting)
            this.fishShadows = [];
            for (let i = 0; i < 4; i++) {
                const shadowGroup = new THREE.Group();
                const shadowBodyGeo = new THREE.SphereGeometry(0.25, 12, 10);
                shadowBodyGeo.scale(1.3, 0.6, 0.6);
                const shadowMat = new THREE.MeshPhongMaterial({
                    color: 0x001a33,
                    transparent: true,
                    opacity: 0.4,
                    shininess: 20
                });
                const shadowBody = new THREE.Mesh(shadowBodyGeo, shadowMat);
                shadowGroup.add(shadowBody);

                const shadowTailGeo = new THREE.ConeGeometry(0.15, 0.3, 6);
                shadowTailGeo.rotateZ(Math.PI / 2);
                const shadowTail = new THREE.Mesh(shadowTailGeo, shadowMat);
                shadowTail.position.set(-0.4, 0, 0);
                shadowGroup.add(shadowTail);

                shadowGroup.visible = false;
                shadowGroup.userData = {
                    speed: 0.02 + Math.random() * 0.03,
                    angle: Math.random() * Math.PI * 2,
                    radius: 3 + Math.random() * 2,
                    heightOffset: -1.5 - Math.random() * 1.5
                };
                this.scene.add(shadowGroup);
                this.fishShadows.push(shadowGroup);
            }

            // Rain particles
            const rainCount = 1000;
            const rainGeo = new THREE.BufferGeometry();
            const rainPos = new Float32Array(rainCount * 3);
            for(let i = 0; i < rainCount * 3; i += 3) {
                rainPos[i] = (Math.random() - 0.5) * 100;
                rainPos[i + 1] = Math.random() * 50;
                rainPos[i + 2] = (Math.random() - 0.5) * 100;
            }
            rainGeo.setAttribute('position', new THREE.BufferAttribute(rainPos, 3));
            this.rain = new THREE.Points(rainGeo, new THREE.PointsMaterial({
                color: 0xaaaaaa,
                size: 0.15,
                transparent: true,
                opacity: 0.6
            }));
            this.rain.visible = false;
            this.scene.add(this.rain);

            window.addEventListener('resize', () => {
                this.camera.aspect = this.container.clientWidth / this.container.clientHeight;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(this.container.clientWidth, this.container.clientHeight);
            });
        }

        initEvents() {
            const down = () => {
                if (this.state === GAME_STATE.IDLE) this.startCharge();
                else if (this.state === GAME_STATE.BITE) this.catch();
            };
            const up = () => { if (this.state === GAME_STATE.CHARGING) this.cast(); };

            this.btn.addEventListener('mousedown', down);
            window.addEventListener('mouseup', up);
            this.btn.addEventListener('touchstart', (e) => { e.preventDefault(); down(); });
            window.addEventListener('touchend', up);

            this.container.addEventListener('mousemove', (e) => {
                const r = this.container.getBoundingClientRect();
                this.mousePos.x = ((e.clientX - r.left) / r.width) * 2 - 1;
                this.mousePos.y = -((e.clientY - r.top) / r.height) * 2 + 1;
            });

            document.getElementById('close-modal').onclick = () => document.getElementById('modal-overlay').style.display = 'none';
            document.getElementById('close-trivia').onclick = () => document.getElementById('trivia-overlay').style.display = 'none';
            document.getElementById('book-btn').onclick = () => this.toggleCollection(true);
            document.getElementById('close-collection').onclick = () => this.toggleCollection(false);

            document.getElementById('time-btn').onclick = () => {
                const times = ['morning', 'day', 'evening', 'night'];
                const currentIndex = times.indexOf(this.timeOfDay);
                const nextIndex = (currentIndex + 1) % times.length;
                this.setTimeOfDay(times[nextIndex]);
            };

            document.getElementById('weather-btn').onclick = () => {
                const weathers = ['sunny', 'cloudy', 'rainy'];
                const currentIndex = weathers.indexOf(this.weather);
                const nextIndex = (currentIndex + 1) % weathers.length;
                this.setWeather(weathers[nextIndex]);
            };

            document.getElementById('location-btn').onclick = () => this.showLocationSelector();
            document.getElementById('close-location').onclick = () => this.closeLocationSelector();
        }

        startCharge() {
            this.state = GAME_STATE.CHARGING;
            this.charge = 0;
            this.powerMeter.style.opacity = '1';
            this.btnText.textContent = 'åŠ›ã‚’ãŸã‚ã‚‹...';
        }

        cast() {
            const p = this.charge / 100;
            this.state = GAME_STATE.FLYING;
            this.powerMeter.style.opacity = '0';
            this.btn.disabled = true;
            this.btnText.textContent = 'å¾…æ©Ÿä¸­...';
            this.bobberData = {
                start: new THREE.Vector3(-4, 6, 4),
                target: new THREE.Vector3((Math.random()-0.5)*12, 0, -8 - (p*30)),
                progress: 0
            };
            this.bobberMesh.visible = true;
            this.fishingLine.visible = true;
        }

        startWaiting() {
            this.state = GAME_STATE.WAITING;

            // Show random fish shadows swimming
            const numShadows = Math.floor(Math.random() * 3) + 1; // 1-3 shadows
            for (let i = 0; i < numShadows; i++) {
                const shadow = this.fishShadows[i];
                if (shadow) {
                    shadow.visible = true;
                    shadow.userData.angle = Math.random() * Math.PI * 2;
                    shadow.userData.centerX = this.bobberMesh.position.x;
                    shadow.userData.centerZ = this.bobberMesh.position.z;
                }
            }

            setTimeout(() => { if (this.state === GAME_STATE.WAITING) this.triggerBite(); }, 3000 + Math.random()*12000);
        }

        triggerBite() {
            this.state = GAME_STATE.BITE;
            this.startTime = Date.now();
            this.btn.disabled = false;
            this.btnText.textContent = 'ãƒ’ãƒƒãƒˆï¼ï¼';
            this.btn.style.background = 'linear-gradient(135deg, var(--accent), #ff0055)';
            this.wrapper.classList.add('shake');
            this.bobberMesh.material.color.set(0xf72585);
            this.biteTimeout = setTimeout(() => { if (this.state === GAME_STATE.BITE) this.miss(); }, 1200);
        }

        miss() {
            this.wrapper.classList.remove('shake');
            this.state = GAME_STATE.IDLE;
            this.reset();
            this.showToast('é€ƒã’ã‚‰ã‚ŒãŸï¼');
        }

        catch() {
            clearTimeout(this.biteTimeout);
            this.wrapper.classList.remove('shake');
            this.state = GAME_STATE.REELING;
            this.btn.disabled = true;
            this.btnText.textContent = 'ãƒªãƒ¼ãƒ«ã‚’å·»ã';
            const bonus = Math.max(0, (1200 - (Date.now() - this.startTime)) / 1200);

            // Show fish jumping
            this.fishGroup.visible = true;
            this.fishGroup.position.copy(this.bobberMesh.position);
            this.fishJumpData = {
                startTime: Date.now(),
                duration: 800,
                startY: this.bobberMesh.position.y,
                jumpHeight: 3
            };

            setTimeout(() => {
                const f = this.selectFish(bonus);
                // Add random size and weight
                f.size = Math.floor(f.sizeRange[0] + Math.random() * (f.sizeRange[1] - f.sizeRange[0]));
                f.weight = (f.weightRange[0] + Math.random() * (f.weightRange[1] - f.weightRange[0])).toFixed(2);

                // Update max records
                if (!this.maxRecords[f.id] || f.size > this.maxRecords[f.id].size) {
                    this.maxRecords[f.id] = { size: f.size, weight: f.weight };
                    localStorage.setItem('fishingMaxRecords', JSON.stringify(this.maxRecords));
                }

                this.showResult(f);
                this.money += f.value; this.caughtCount++; this.collection.add(f.id);
                this.updateUI(); this.state = GAME_STATE.IDLE; this.reset();
            }, 800);
        }

        selectFish(luck) {
            const currentTime = this.timeOfDay;
            const currentWeather = this.weather;
            const currentLoc = this.currentLocation;
            const weatherBonus = WEATHER[currentWeather].rareFishBonus;

            // Filter fish based on current conditions
            const availableFish = FISH_DATA.filter(f => {
                // Check location
                if (!f.location.includes(currentLoc)) {
                    return false;
                }
                // Check time condition
                if (f.conditions.time && !f.conditions.time.includes(currentTime)) {
                    return false;
                }
                // Check weather condition
                if (f.conditions.weather && !f.conditions.weather.includes(currentWeather)) {
                    return false;
                }
                return true;
            });

            // Calculate weights for available fish
            const p = availableFish.map(f => {
                const isRare = f.rarity === 'rare' || f.rarity === 'epic' || f.rarity === 'legendary';
                return {
                    ...f,
                    w: f.chance * (1 + luck * (f.rarity === 'legendary' ? 10 : 2)) * (isRare ? weatherBonus : 1.0)
                };
            });

            const t = p.reduce((s, f) => s + f.w, 0);
            let r = Math.random() * t;
            for(const f of p) { if(r < f.w) return f; r -= f.w; }
            return p[0];
        }

        reset() {
            this.btn.disabled = false; this.btnText.textContent = 'æŠ•ã’ã‚‹'; this.btn.style.background = '';
            this.bobberMesh.visible = false; this.fishingLine.visible = false;
            this.bobberMesh.material.color.set(0x4cc9f0);
            this.fishGroup.visible = false;
            this.fishShadows.forEach(shadow => shadow.visible = false);
        }

        setTimeOfDay(time) {
            this.timeOfDay = time;
            const settings = TIME_OF_DAY[time];

            // Update background and fog
            this.scene.background.setHex(settings.bg);
            this.scene.fog.color.setHex(settings.fog);

            // Update lights with weather modifier
            this.sunLight.color.setHex(settings.sunColor);

            let weatherModifier = 1.0;
            if (this.weather === 'cloudy') weatherModifier = 0.7;
            if (this.weather === 'rainy') weatherModifier = 0.6;

            this.sunLight.intensity = settings.sunIntensity * weatherModifier;
            this.ambientLight.intensity = settings.ambientIntensity * weatherModifier;

            // Update fog density based on weather
            const weatherSettings = WEATHER[this.weather];
            this.scene.fog.density = weatherSettings.fogDensity;

            // Update UI
            document.getElementById('time-icon').textContent = settings.icon;
            document.getElementById('time-name').textContent = settings.name;
        }

        setWeather(weather) {
            this.weather = weather;
            const settings = WEATHER[weather];

            // Update fog density
            this.scene.fog.density = settings.fogDensity;

            // Show/hide rain
            this.rain.visible = (weather === 'rainy');

            // Get base lighting from current time of day
            const timeSettings = TIME_OF_DAY[this.timeOfDay];

            // Apply weather modifier to lighting
            let weatherModifier = 1.0;
            if (weather === 'cloudy') weatherModifier = 0.7;
            if (weather === 'rainy') weatherModifier = 0.6;

            this.sunLight.intensity = timeSettings.sunIntensity * weatherModifier;
            this.ambientLight.intensity = timeSettings.ambientIntensity * weatherModifier;

            // Update UI
            document.getElementById('weather-icon').textContent = settings.icon;
            document.getElementById('weather-name').textContent = settings.name;
        }

        showResult(f) {
            document.getElementById('res-icon').textContent = f.icon;
            document.getElementById('res-name').textContent = f.name;
            document.getElementById('res-size').textContent = `${f.size}cm`;
            document.getElementById('res-weight').textContent = `${f.weight}kg`;
            document.getElementById('res-value').textContent = `+Â¥${f.value.toLocaleString()}`;
            const rarityEl = document.getElementById('res-rarity');
            rarityEl.className = `modal-rarity rarity-${f.rarity}`;
            rarityEl.textContent = f.rarityJp;
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        updateUI() {
            document.getElementById('ui-money').textContent = this.money.toLocaleString();
            document.getElementById('ui-caught').textContent = this.caughtCount;
            localStorage.setItem('fishingMoney', this.money.toString());
            localStorage.setItem('fishingCaughtCount', this.caughtCount.toString());
        }

        toggleCollection(s) {
            const v = document.getElementById('collection-view');
            if (s) {
                const g = document.getElementById('collection-grid'); g.innerHTML = '';
                FISH_DATA.forEach(f => {
                    const found = this.collection.has(f.id);
                    const record = this.maxRecords[f.id];
                    const recordText = found && record ? `<div style="font-size:10px; opacity:0.8; margin-top:4px; color:#4cc9f0;">æœ€å¤§: ${record.size}cm / ${record.weight}kg</div>` : '';
                    const c = document.createElement('div'); c.className = `fish-card ${found?'found':'locked'}`;
                    c.innerHTML = `<div style="font-size:40px;">${found?f.icon:'ï¼Ÿ'}</div><div style="font-size:14px; font-weight:900; margin-top:8px;">${found?f.name:'æœªç™ºè¦‹'}</div><div style="font-size:10px; opacity:0.6; margin-top:4px;">${f.rarityJp}</div>${recordText}`;
                    if (found) {
                        c.style.cursor = 'pointer';
                        c.onclick = () => this.showTrivia(f);
                    }
                    g.appendChild(c);
                });
                v.style.display = 'flex'; setTimeout(() => v.classList.add('show'), 10);
            } else { v.classList.remove('show'); setTimeout(() => v.style.display = 'none', 300); }
        }

        showTrivia(fish) {
            document.getElementById('trivia-icon').textContent = fish.icon;
            document.getElementById('trivia-name').textContent = fish.name;
            document.getElementById('trivia-text').textContent = fish.trivia;
            document.getElementById('trivia-overlay').style.display = 'flex';
        }

        showLocationSelector() {
            const v = document.getElementById('location-view');
            const g = document.getElementById('location-grid');
            g.innerHTML = '';

            Object.keys(LOCATIONS).forEach(key => {
                const loc = LOCATIONS[key];
                const unlocked = this.unlockedLocations.includes(key);
                const current = this.currentLocation === key;

                const card = document.createElement('div');
                card.style.cssText = `
                    background: ${current ? 'linear-gradient(135deg, #0ea5e9, #0284c7)' : 'rgba(255,255,255,0.05)'};
                    border-radius: 20px;
                    padding: 25px;
                    text-align: center;
                    border: ${current ? '2px solid #4cc9f0' : '1px solid rgba(255,255,255,0.1)'};
                    cursor: ${unlocked ? 'pointer' : 'default'};
                    opacity: ${unlocked ? '1' : '0.4'};
                    transition: all 0.2s;
                `;

                card.innerHTML = `
                    <div style="font-size: 48px; margin-bottom: 10px;">${loc.icon}</div>
                    <div style="font-size: 18px; font-weight: 900; margin-bottom: 5px;">${loc.name}</div>
                    <div style="font-size: 12px; opacity: 0.7; margin-bottom: 10px;">${loc.description}</div>
                    ${unlocked ?
                        (current ? '<div style="font-size: 14px; font-weight: 900; color: #4cc9f0;">âœ“ ç¾åœ¨åœ°</div>' : '<div style="font-size: 14px; font-weight: 700;">ç§»å‹•ã™ã‚‹</div>') :
                        `<div style="font-size: 14px; font-weight: 900; color: #fbbf24;">Â¥${loc.cost.toLocaleString()}</div>`
                    }
                `;

                if (!unlocked) {
                    card.onclick = () => this.unlockLocation(key);
                    card.style.cursor = 'pointer';
                } else if (!current) {
                    card.onclick = () => this.setLocation(key);
                }

                g.appendChild(card);
            });

            v.style.display = 'flex';
        }

        closeLocationSelector() {
            document.getElementById('location-view').style.display = 'none';
        }

        unlockLocation(key) {
            const loc = LOCATIONS[key];
            if (this.money >= loc.cost) {
                this.money -= loc.cost;
                this.unlockedLocations.push(key);
                localStorage.setItem('fishingUnlockedLocations', JSON.stringify(this.unlockedLocations));
                this.updateUI();
                this.setLocation(key);
                this.showToast(`${loc.name}ã‚’è§£æ”¾ã—ã¾ã—ãŸï¼`);
                this.closeLocationSelector();
            } else {
                this.showToast(`ãŠé‡‘ãŒè¶³ã‚Šã¾ã›ã‚“ï¼ˆå¿…è¦: Â¥${loc.cost.toLocaleString()}ï¼‰`);
            }
        }

        setLocation(key) {
            this.currentLocation = key;
            const loc = LOCATIONS[key];
            document.getElementById('location-icon').textContent = loc.icon;
            document.getElementById('location-name').textContent = loc.name;
            this.closeLocationSelector();
            this.showToast(`${loc.name}ã«ç§»å‹•ã—ã¾ã—ãŸ`);
        }

        showToast(m) { const t = document.getElementById('toast'); t.textContent = m; t.style.display = 'block'; setTimeout(() => t.style.display = 'none', 2000); }

        animate() {
            const t = Date.now() * 0.001;
            this.camera.position.x += (this.mousePos.x * 3 - this.camera.position.x) * 0.05;
            this.camera.lookAt(0, 1, -5);

            const v = this.sea.geometry.attributes.position.array;
            for(let i=0; i<v.length; i+=3) { v[i+2] = Math.sin(v[i]*0.15 + t)*0.4 + Math.cos(v[i+1]*0.15 + t)*0.4; }
            this.sea.geometry.attributes.position.needsUpdate = true;
            this.bubbles.position.y += 0.01; if(this.bubbles.position.y > 5) this.bubbles.position.y = -5;

            // Animate rain
            if (this.rain.visible) {
                const rainPos = this.rain.geometry.attributes.position.array;
                for(let i = 1; i < rainPos.length; i += 3) {
                    rainPos[i] -= 0.5;
                    if(rainPos[i] < 0) rainPos[i] = 50;
                }
                this.rain.geometry.attributes.position.needsUpdate = true;
            }

            if (this.state === GAME_STATE.CHARGING) { this.charge = (this.charge + 2.0) % 100; this.powerFill.style.width = `${this.charge}%`; }
            
            if (this.bobberMesh.visible) {
                if (this.state === GAME_STATE.FLYING && this.bobberData) {
                    this.bobberData.progress += 0.035; const p = this.bobberData.progress;
                    this.bobberMesh.position.lerpVectors(this.bobberData.start, this.bobberData.target, p);
                    this.bobberMesh.position.y += Math.sin(p * Math.PI) * 5;
                    if (p >= 1) { this.state = GAME_STATE.WAITING; this.startWaiting(); }
                    this.rodGroup.rotation.x = 0.6 - Math.sin(p*Math.PI)*0.4;
                } else {
                    this.bobberMesh.position.y = Math.sin(t*4)*0.15;
                    if(this.state === GAME_STATE.BITE) this.bobberMesh.position.y += Math.sin(t*30)*0.5;
                }
                const rodTip = new THREE.Vector3().setFromMatrixPosition(this.rodGroup.children[2].matrixWorld);
                this.fishingLine.geometry.setAttribute('position', new THREE.BufferAttribute(new Float32Array([rodTip.x, rodTip.y, rodTip.z, this.bobberMesh.position.x, this.bobberMesh.position.y, this.bobberMesh.position.z]), 3));
            } else {
                this.rodGroup.rotation.x = 0.6 + Math.sin(t)*0.02;
            }

            // Animate jumping fish
            if (this.fishGroup.visible && this.fishJumpData) {
                const elapsed = Date.now() - this.fishJumpData.startTime;
                const progress = Math.min(elapsed / this.fishJumpData.duration, 1);
                const jumpArc = Math.sin(progress * Math.PI);
                this.fishGroup.position.y = this.fishJumpData.startY + jumpArc * this.fishJumpData.jumpHeight;
                this.fishGroup.rotation.y = t * 5;
                this.fishGroup.rotation.x = Math.sin(progress * Math.PI * 2) * 0.5;
                if (progress >= 1) this.fishJumpData = null;
            }

            // Animate swimming fish shadows
            this.fishShadows.forEach(shadow => {
                if (shadow.visible) {
                    const data = shadow.userData;
                    data.angle += data.speed;
                    shadow.position.x = data.centerX + Math.cos(data.angle) * data.radius;
                    shadow.position.z = data.centerZ + Math.sin(data.angle) * data.radius;
                    shadow.position.y = data.heightOffset + Math.sin(t * 2 + data.angle) * 0.3;
                    shadow.rotation.y = data.angle + Math.PI / 2;
                    shadow.rotation.x = Math.sin(t * 3) * 0.1;
                }
            });

            this.renderer.render(this.scene, this.camera);
            requestAnimationFrame(() => this.animate());
        }
    }
    window.onload = () => new FishingExperience();
</script>
</body>
</html>