<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Random Pokémon Discovery Ultimate UI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-bg: rgba(0, 0, 0, 0.3);
            --neon-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        body {
            font-family: 'DotGothic16', sans-serif;
            background-color: #3a3a3a;
            background-image: 
                linear-gradient(rgba(50, 50, 50, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(50, 50, 50, 0.1) 1px, transparent 1px);
            background-size: 40px 40px;
            color: #e0e0e0;
            /* モバイルブラウザのアドレスバー対策 */
            height: 100dvh; 
            width: 100vw;
            overflow-x: hidden;
            overflow-y: auto;
        }

        .pixel-art {
            image-rendering: pixelated;
        }

        /* --- Animations --- */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; filter: blur(4px); }
            100% { transform: scale(1); opacity: 1; filter: blur(0); }
        }
        @keyframes drift {
            0% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(20px, -30px) rotate(10deg); }
            66% { transform: translate(-10px, 10px) rotate(-5deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .animate-float { animation: float 4s ease-in-out infinite; }
        .pop-in { animation: popIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
        .animate-drift { animation: drift 20s ease-in-out infinite; }
        .animate-spin-super-slow { animation: spin-slow 60s linear infinite; }
        .animate-spin-super-slow-rev { animation: spin-slow 45s linear infinite reverse; }

        /* --- UI Components --- */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        /* デバイスフレーム：レスポンシブ対応 */
        .device-frame {
            background: #151515;
            /* スマホでは全画面、PCではフレームあり */
            transition: all 0.5s ease;
        }

        .screen-container {
            background: #000;
            position: relative;
            overflow: hidden;
        }

        /* Scanlines & Grid Overlay */
        .scanlines::after {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: 
                linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%),
                linear-gradient(90deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0) 2px),
                linear-gradient(0deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0) 2px);
            background-size: 100% 4px, 50px 100%, 100% 50px;
            pointer-events: none;
            z-index: 10;
        }

        /* Stat Bars */
        .stat-bar-bg { background: rgba(255,255,255,0.05); }
        .stat-fill {
            height: 100%;
            border-radius: 2px;
            position: relative;
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Type Gradient Backgrounds */
        .bg-gradient-normal { background: radial-gradient(circle at 30% 50%, #A8A77A44, transparent 80%); }
        .bg-gradient-fire { background: radial-gradient(circle at 30% 50%, #EE813044, transparent 80%); }
        .bg-gradient-water { background: radial-gradient(circle at 30% 50%, #6390F044, transparent 80%); }
        .bg-gradient-electric { background: radial-gradient(circle at 30% 50%, #F7D02C44, transparent 80%); }
        .bg-gradient-grass { background: radial-gradient(circle at 30% 50%, #7AC74C44, transparent 80%); }
        .bg-gradient-ice { background: radial-gradient(circle at 30% 50%, #96D9D644, transparent 80%); }
        .bg-gradient-fighting { background: radial-gradient(circle at 30% 50%, #C22E2844, transparent 80%); }
        .bg-gradient-poison { background: radial-gradient(circle at 30% 50%, #A33EA144, transparent 80%); }
        .bg-gradient-ground { background: radial-gradient(circle at 30% 50%, #E2BF6544, transparent 80%); }
        .bg-gradient-flying { background: radial-gradient(circle at 30% 50%, #A98FF344, transparent 80%); }
        .bg-gradient-psychic { background: radial-gradient(circle at 30% 50%, #F9558744, transparent 80%); }
        .bg-gradient-bug { background: radial-gradient(circle at 30% 50%, #A6B91A44, transparent 80%); }
        .bg-gradient-rock { background: radial-gradient(circle at 30% 50%, #B6A13644, transparent 80%); }
        .bg-gradient-ghost { background: radial-gradient(circle at 30% 50%, #73579744, transparent 80%); }
        .bg-gradient-dragon { background: radial-gradient(circle at 30% 50%, #6F35FC44, transparent 80%); }
        .bg-gradient-dark { background: radial-gradient(circle at 30% 50%, #70574644, transparent 80%); }
        .bg-gradient-steel { background: radial-gradient(circle at 30% 50%, #B7B7CE44, transparent 80%); }
        .bg-gradient-fairy { background: radial-gradient(circle at 30% 50%, #D685AD44, transparent 80%); }

        /* Badge Styles */
        .type-badge {
            text-shadow: 0 1px 2px rgba(0,0,0,0.8);
            box-shadow: 0 2px 4px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* Scrollbar */
        .custom-scroll {
            scrollbar-width: thin;
            scrollbar-color: rgba(255,255,255,0.2) transparent;
        }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 3px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.3); }
        
        /* Shiny Button */
        #shiny-btn.active {
            background: rgba(255, 215, 0, 0.2);
            color: #FFD700;
            border-color: #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
        }
    </style>
</head>
<body class="h-full w-full flex items-center justify-center p-0 sm:p-6 relative overflow-x-hidden overflow-y-auto">

    <!-- Global Background Elements (Scattered Pokéballs) -->
    <div class="fixed inset-0 pointer-events-none z-0 overflow-hidden">
        <!-- Big Top Right -->
        <div class="absolute -top-20 -right-20 w-96 h-96 text-white/5 animate-spin-super-slow">
             <svg viewBox="0 0 100 100" fill="currentColor"><circle cx="50" cy="50" r="45" stroke="currentColor" stroke-width="2" fill="none"/><path d="M 5,50 L 95,50" stroke="currentColor" stroke-width="2"/><circle cx="50" cy="50" r="15" stroke="currentColor" stroke-width="2" fill="none"/><circle cx="50" cy="50" r="8" fill="currentColor"/></svg>
        </div>
        <!-- Bottom Left -->
        <div class="absolute -bottom-32 -left-20 w-[500px] h-[500px] text-white/5 animate-spin-super-slow-rev">
             <svg viewBox="0 0 100 100" fill="currentColor"><circle cx="50" cy="50" r="45" stroke="currentColor" stroke-width="1" fill="none"/><path d="M 5,50 L 95,50" stroke="currentColor" stroke-width="1"/><circle cx="50" cy="50" r="15" stroke="currentColor" stroke-width="1" fill="none"/><circle cx="50" cy="50" r="8" fill="currentColor"/></svg>
        </div>
    </div>

    <!-- Responsive Device Frame -->
    <div class="device-frame w-full h-auto min-h-[100dvh] sm:h-auto sm:max-h-[90vh] sm:max-w-7xl flex flex-col relative overflow-hidden z-10 backdrop-blur-sm bg-[#151515]/90 rounded-none sm:rounded-[20px] shadow-none sm:shadow-[0_20px_80px_rgba(0,0,0,0.8)] border-0 sm:border border-[#444]">
        
        <!-- Header / Sensor Array -->
        <div class="h-14 flex items-center justify-between px-6 border-b border-[#333] bg-[#1a1a1a]/90 shrink-0 z-20">
            <div class="flex items-center gap-4">
                <div class="flex gap-2">
                    <div class="w-3 h-3 rounded-full bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.8)] animate-pulse"></div>
                    <div class="w-3 h-3 rounded-full bg-yellow-500 opacity-60"></div>
                    <div class="w-3 h-3 rounded-full bg-green-500 opacity-60"></div>
                </div>
                <div class="h-4 w-[1px] bg-gray-700"></div>
                <div class="text-xs text-gray-400 tracking-[0.2em] font-sans">VIBE-DEX v4.1 <span class="hidden sm:inline opacity-50">| WIDE-SCREEN</span></div>
            </div>
            <!-- Battery/Status Mockup -->
            <div class="hidden sm:flex items-center gap-3 text-[10px] text-gray-500 font-mono">
                <span>NET: ONLINE</span>
                <i class="fa-solid fa-wifi"></i>
                <span>BATT: 100%</span>
                <i class="fa-solid fa-battery-full"></i>
            </div>
        </div>

        <!-- Main Screen Area -->
        <div class="relative flex-1 bg-black overflow-hidden flex flex-col md:flex-row group min-h-0">
            
            <!-- Dynamic Background (Shared) -->
            <div id="type-bg" class="absolute inset-0 transition-all duration-1000 ease-in-out opacity-40"></div>
            <div class="scanlines absolute inset-0 pointer-events-none z-10"></div>

            <!-- Scattered Balls INSIDE Screen too (Subtle) -->
            <div class="absolute inset-0 overflow-hidden pointer-events-none z-0">
                 <div class="absolute top-[20%] right-[30%] w-64 h-64 text-white/[0.03] animate-spin-super-slow">
                     <svg viewBox="0 0 100 100" fill="currentColor"><circle cx="50" cy="50" r="45" stroke="currentColor" stroke-width="2" fill="none"/><path d="M 5,50 L 95,50" stroke="currentColor" stroke-width="2"/><circle cx="50" cy="50" r="15" stroke="currentColor" stroke-width="2" fill="none"/><circle cx="50" cy="50" r="8" fill="currentColor"/></svg>
                 </div>
            </div>

            <!-- Initial Placeholder (Overlay) -->
            <div id="placeholder" class="absolute inset-0 flex flex-col items-center justify-center text-gray-400 z-50 bg-black/90 backdrop-blur-md transition-opacity duration-500">
                <div class="relative mb-8 group cursor-pointer transform hover:scale-105 transition-transform duration-300" onclick="summonPokemon()">
                    <div class="absolute inset-0 bg-red-600/20 rounded-full blur-2xl animate-pulse"></div>
                    <i class="fa-solid fa-fingerprint text-8xl text-gray-600 group-hover:text-white transition-colors duration-500"></i>
                </div>
                <p class="text-lg tracking-[0.3em] animate-pulse font-sans font-bold">SYSTEM READY</p>
                <p class="text-xs tracking-wider opacity-60 mt-2">TAP TO INITIALIZE (タップして起動)</p>
            </div>

            <!-- Loading Overlay -->
            <div id="loading" class="hidden absolute inset-0 bg-black/95 z-50 flex flex-col items-center justify-center text-white backdrop-blur-xl">
                <div class="relative w-24 h-24 mb-6">
                    <div class="absolute inset-0 border-4 border-t-red-500 border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"></div>
                    <div class="absolute inset-2 border-4 border-t-transparent border-r-white border-b-transparent border-l-transparent rounded-full animate-spin reverse-spin" style="animation-direction: reverse; animation-duration: 1.5s;"></div>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i class="fa-solid fa-bolt text-2xl text-yellow-400 animate-pulse"></i>
                    </div>
                </div>
                <p class="text-sm tracking-[0.3em] font-sans">SEARCHING DATABASE...</p>
                <p id="loading-text" class="text-[10px] text-gray-500 mt-2 font-mono">ESTABLISHING CONNECTION</p>
            </div>

            <!-- CONTENT: LEFT COLUMN (Visuals - PC Only) -->
            <div id="pokemon-visual" class="hidden md:flex md:w-5/12 lg:w-1/2 relative flex-col items-center justify-center p-8 z-20 border-r border-white/5">
                
                <!-- Main Visual Container -->
                <div class="relative w-full max-w-md aspect-square flex items-center justify-center">
                    <!-- Hologram Effects -->
                    <div class="absolute inset-0 border border-white/5 rounded-full animate-pulse scale-90 opacity-50"></div>
                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[120%] h-[1px] bg-gradient-to-r from-transparent via-white/10 to-transparent"></div>
                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[1px] h-[120%] bg-gradient-to-b from-transparent via-white/10 to-transparent"></div>
                    
                    <!-- Shiny Toggle -->
                    <button id="shiny-btn" onclick="toggleShiny()" class="absolute top-4 right-4 w-12 h-12 rounded-full glass-panel flex items-center justify-center text-gray-400 hover:text-yellow-300 hover:scale-110 transition-all z-30 group border-white/10">
                        <i class="fa-solid fa-star text-lg group-hover:rotate-180 transition-transform duration-500"></i>
                    </button>

                    <!-- The Pokemon Image -->
                    <img id="poke-img" src="" class="w-4/5 h-4/5 object-contain pixel-art z-20 filter drop-shadow-[0_20px_30px_rgba(0,0,0,0.6)] animate-float" alt="Pokemon">
                </div>

                <!-- Basic Info (Large Screen visual hierarchy) -->
                <div class="mt-6 text-center">
                    <div id="poke-id-large" class="text-4xl font-bold opacity-20 font-sans italic tracking-tighter absolute top-4 left-6">No.000</div>
                    <div id="poke-types" class="flex justify-center gap-3 mt-4"></div>
                </div>
            </div>

            <!-- CONTENT: RIGHT COLUMN (Data - Scrollable) -->
            <div id="pokemon-data-panel" class="hidden flex-1 overflow-y-auto custom-scroll relative z-20 bg-black/20 backdrop-blur-sm flex flex-col">
                
                <div class="p-4 sm:p-6 md:p-8 flex flex-col gap-6 pb-20">
                    <!-- Mobile Only Visual Header (When stacked vertically) -->
                    <div class="md:hidden flex flex-col items-center mb-2 shrink-0">
                        <div class="relative w-full max-w-[240px] aspect-square flex items-center justify-center">
                            <!-- Mobile Hologram -->
                            <div class="absolute inset-0 border border-white/5 rounded-full animate-pulse scale-90 opacity-50"></div>
                            
                            <img id="poke-img-mobile" src="" class="w-full h-full object-contain pixel-art z-20 filter drop-shadow-[0_10px_20px_rgba(0,0,0,0.6)] animate-float" alt="Pokemon">
                            <!-- Mobile Shiny Toggle -->
                            <button onclick="toggleShiny()" class="absolute top-2 right-2 w-10 h-10 rounded-full glass-panel flex items-center justify-center text-gray-400 z-30 border-white/10 active:scale-95 transition-transform">
                                <i class="fa-solid fa-star text-sm"></i>
                            </button>
                        </div>
                        
                        <!-- Mobile Type Badges (Since Left Column is hidden) -->
                        <div id="poke-types-mobile" class="flex justify-center gap-2 mt-2 flex-wrap"></div>
                    </div>

                    <!-- Header Info -->
                    <div class="border-b border-white/10 pb-4 shrink-0">
                        <div class="flex justify-between items-start">
                            <div>
                                <span id="poke-genus" class="text-[10px] uppercase tracking-[0.2em] opacity-70 text-red-400">LOADING...</span>
                                <h1 id="poke-name" class="text-3xl sm:text-4xl md:text-5xl font-bold leading-tight mt-1 bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-400">Name</h1>
                                <p id="poke-en-name" class="text-sm font-sans tracking-wider opacity-50 mt-1">English Name</p>
                            </div>
                            <div class="hidden md:block text-right">
                                <i class="fa-solid fa-circle-nodes text-2xl opacity-20"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Info Grid -->
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 shrink-0">
                        <div class="glass-panel p-3 rounded-lg text-center">
                            <div class="text-[9px] text-gray-500 tracking-widest mb-1">HEIGHT (高さ)</div>
                            <div id="poke-height" class="text-xl font-mono">0.0m</div>
                        </div>
                        <div class="glass-panel p-3 rounded-lg text-center">
                            <div class="text-[9px] text-gray-500 tracking-widest mb-1">WEIGHT (重さ)</div>
                            <div id="poke-weight" class="text-xl font-mono">0.0kg</div>
                        </div>
                        <div class="glass-panel p-3 rounded-lg col-span-2 flex flex-col justify-center px-4">
                            <div class="flex justify-between text-[9px] text-gray-500 tracking-widest mb-2">
                                <span>GENDER RATIO (性別比)</span>
                                <span id="gender-text">Unknown</span>
                            </div>
                            <div class="h-2 bg-gray-800 rounded-full overflow-hidden flex w-full">
                                <div id="gender-male" class="h-full bg-blue-500 shadow-[0_0_10px_rgba(59,130,246,0.5)]"></div>
                                <div id="gender-female" class="h-full bg-pink-500 shadow-[0_0_10px_rgba(236,72,153,0.5)]"></div>
                                <div id="gender-unknown" class="h-full w-full hidden text-[8px] flex items-center justify-center text-gray-600 bg-gray-900">-</div>
                            </div>
                        </div>
                    </div>

                    <!-- Abilities & Eggs -->
                    <div class="flex flex-col sm:flex-row gap-4 shrink-0">
                        <div class="glass-panel p-4 rounded-lg flex-1">
                            <div class="text-[9px] text-gray-500 tracking-widest mb-2">ABILITY (特性)</div>
                            <div id="poke-abilities" class="flex flex-wrap gap-2"></div>
                        </div>
                        <div class="glass-panel p-4 rounded-lg flex-1">
                            <div class="text-[9px] text-gray-500 tracking-widest mb-2">EGG GROUP (タマゴ)</div>
                            <div id="poke-egg-groups" class="flex flex-wrap gap-2"></div>
                        </div>
                    </div>

                    <!-- Flavor Text -->
                    <div class="glass-panel p-5 rounded-lg border-l-2 border-red-500/50 bg-gradient-to-r from-red-900/10 to-transparent shrink-0">
                        <p id="poke-desc" class="text-sm leading-relaxed tracking-wide opacity-90 font-medium"></p>
                    </div>

                    <!-- Stats (Wide Layout) -->
                    <div class="glass-panel p-5 rounded-lg shrink-0">
                        <h3 class="text-[10px] text-gray-500 tracking-[0.3em] mb-4 border-b border-white/5 pb-2">BASE STATS (種族値)</h3>
                        <div class="space-y-3">
                            <!-- Stat Rows -->
                            <div class="grid grid-cols-[50px_40px_1fr] gap-3 items-center text-xs">
                                <span class="text-gray-500 font-bold">HP</span>
                                <span id="val-hp" class="text-right font-mono">0</span>
                                <div class="h-2 stat-bar-bg rounded-sm overflow-hidden"><div id="stat-hp" class="stat-fill bg-green-500/80 shadow-[0_0_10px_rgba(34,197,94,0.4)]" style="width:0%"></div></div>
                            </div>
                            <div class="grid grid-cols-[50px_40px_1fr] gap-3 items-center text-xs">
                                <span class="text-gray-500 font-bold">攻撃</span>
                                <span id="val-atk" class="text-right font-mono">0</span>
                                <div class="h-2 stat-bar-bg rounded-sm overflow-hidden"><div id="stat-atk" class="stat-fill bg-red-500/80 shadow-[0_0_10px_rgba(239,68,68,0.4)]" style="width:0%"></div></div>
                            </div>
                            <div class="grid grid-cols-[50px_40px_1fr] gap-3 items-center text-xs">
                                <span class="text-gray-500 font-bold">防御</span>
                                <span id="val-def" class="text-right font-mono">0</span>
                                <div class="h-2 stat-bar-bg rounded-sm overflow-hidden"><div id="stat-def" class="stat-fill bg-yellow-500/80 shadow-[0_0_10px_rgba(234,179,8,0.4)]" style="width:0%"></div></div>
                            </div>
                            <div class="grid grid-cols-[50px_40px_1fr] gap-3 items-center text-xs">
                                <span class="text-gray-500 font-bold">特攻</span>
                                <span id="val-spa" class="text-right font-mono">0</span>
                                <div class="h-2 stat-bar-bg rounded-sm overflow-hidden"><div id="stat-spa" class="stat-fill bg-pink-500/80 shadow-[0_0_10px_rgba(236,72,153,0.4)]" style="width:0%"></div></div>
                            </div>
                            <div class="grid grid-cols-[50px_40px_1fr] gap-3 items-center text-xs">
                                <span class="text-gray-500 font-bold">特防</span>
                                <span id="val-spd" class="text-right font-mono">0</span>
                                <div class="h-2 stat-bar-bg rounded-sm overflow-hidden"><div id="stat-spd" class="stat-fill bg-indigo-500/80 shadow-[0_0_10px_rgba(99,102,241,0.4)]" style="width:0%"></div></div>
                            </div>
                            <div class="grid grid-cols-[50px_40px_1fr] gap-3 items-center text-xs">
                                <span class="text-gray-500 font-bold">素早</span>
                                <span id="val-spe" class="text-right font-mono">0</span>
                                <div class="h-2 stat-bar-bg rounded-sm overflow-hidden"><div id="stat-spe" class="stat-fill bg-blue-500/80 shadow-[0_0_10px_rgba(59,130,246,0.4)]" style="width:0%"></div></div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Footer Control Bar -->
        <div class="h-16 md:h-20 border-t border-[#333] bg-[#1a1a1a]/90 flex items-center px-4 sm:px-6 gap-4 shrink-0 z-30">
            
            <!-- Gen Selector -->
            <div class="relative w-1/3 max-w-[200px] group">
                <div class="absolute inset-y-0 left-3 flex items-center pointer-events-none text-gray-500">
                    <i class="fa-solid fa-earth-americas"></i>
                </div>
                <select id="gen-selector" class="w-full bg-[#111] text-gray-300 text-xs border border-[#333] rounded-lg py-3 pl-10 pr-3 focus:outline-none focus:border-red-500 focus:ring-1 focus:ring-red-500 appearance-none cursor-pointer transition-all hover:bg-[#222]">
                    <option value="0" selected>全地方 (All)</option>
                    <option value="1">カントー (Kanto)</option>
                    <option value="2">ジョウト (Johto)</option>
                    <option value="3">ホウエン (Hoenn)</option>
                    <option value="4">シンオウ (Sinnoh)</option>
                    <option value="5">イッシュ (Unova)</option>
                    <option value="6">カロス (Kalos)</option>
                    <option value="7">アローラ (Alola)</option>
                    <option value="8">ガラル (Galar)</option>
                    <option value="9">パルデア (Paldea)</option>
                </select>
                <div class="absolute inset-y-0 right-3 flex items-center pointer-events-none text-gray-500 text-[10px]">
                    ▼
                </div>
            </div>

            <!-- Summon Button -->
            <button onclick="summonPokemon()" id="summon-btn" class="flex-1 bg-gradient-to-r from-red-700 to-red-600 text-white font-bold py-3 px-6 rounded-lg shadow-[0_4px_0_rgb(127,29,29)] active:shadow-none active:translate-y-[4px] transition-all flex items-center justify-center gap-3 group border border-red-500/30 hover:brightness-110 overflow-hidden relative">
                <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"></div>
                <i class="fa-solid fa-dna text-lg group-hover:rotate-180 transition-transform duration-500"></i>
                <span class="tracking-[0.2em] text-sm md:text-base">SUMMON (召喚)</span>
            </button>
        </div>

    </div>

    <!-- Audio -->
    <audio id="cry-audio"></audio>

    <script>
        // DOM Elements
        const placeholder = document.getElementById('placeholder');
        const pokemonVisual = document.getElementById('pokemon-visual');
        const pokemonDataPanel = document.getElementById('pokemon-data-panel');
        const loading = document.getElementById('loading');
        const loadingText = document.getElementById('loading-text');
        const genSelector = document.getElementById('gen-selector');
        const typeBg = document.getElementById('type-bg');
        
        // Output Elements
        const pokeImg = document.getElementById('poke-img');
        const pokeImgMobile = document.getElementById('poke-img-mobile');
        const pokeName = document.getElementById('poke-name');
        const pokeEnName = document.getElementById('poke-en-name');
        const pokeGenus = document.getElementById('poke-genus');
        const pokeIdLarge = document.getElementById('poke-id-large');
        const pokeTypes = document.getElementById('poke-types');
        const pokeTypesMobile = document.getElementById('poke-types-mobile'); // Added for mobile types
        const pokeAbilities = document.getElementById('poke-abilities');
        const pokeEggGroups = document.getElementById('poke-egg-groups');
        const pokeDesc = document.getElementById('poke-desc');
        const pokeHeight = document.getElementById('poke-height');
        const pokeWeight = document.getElementById('poke-weight');
        const cryAudio = document.getElementById('cry-audio');
        const shinyBtn = document.getElementById('shiny-btn');
        
        // Gender Elements
        const genderText = document.getElementById('gender-text');
        const genderMale = document.getElementById('gender-male');
        const genderFemale = document.getElementById('gender-female');
        const genderUnknown = document.getElementById('gender-unknown');

        // State
        let currentPokemon = null; 
        let isShiny = false;

        // Generation Ranges
        const GEN_RANGES = {
            0: { min: 1, max: 1025 },
            1: { min: 1, max: 151 },
            2: { min: 152, max: 251 },
            3: { min: 252, max: 386 },
            4: { min: 387, max: 493 },
            5: { min: 494, max: 649 },
            6: { min: 650, max: 721 },
            7: { min: 722, max: 809 },
            8: { min: 810, max: 905 },
            9: { min: 906, max: 1025 }
        };

        // Main Function
        async function summonPokemon() {
            setLoading(true, "ACCESSING NETWORK...");
            
            isShiny = false;
            updateShinyButton();
            
            const gen = parseInt(genSelector.value);
            const range = GEN_RANGES[gen];
            const id = Math.floor(Math.random() * (range.max - range.min + 1)) + range.min;

            try {
                // Fetch Data
                const [pokemonRes, speciesRes] = await Promise.all([
                    fetch(`https://pokeapi.co/api/v2/pokemon/${id}`),
                    fetch(`https://pokeapi.co/api/v2/pokemon-species/${id}`)
                ]);

                if (!pokemonRes.ok || !speciesRes.ok) throw new Error('Data fetch failed');

                const pokemon = await pokemonRes.json();
                const species = await speciesRes.json();
                
                currentPokemon = { ...pokemon, speciesData: species };

                // Fetch Abilities
                setLoading(true, "ANALYZING DNA SEQUENCE...");
                const abilityPromises = pokemon.abilities.map(a => fetch(a.ability.url).then(r => r.json()));
                const abilitiesData = await Promise.all(abilityPromises);

                // Process Text
                const jaName = species.names.find(n => n.language.name === 'ja')?.name || pokemon.name;
                const enName = species.names.find(n => n.language.name === 'en')?.name || pokemon.name;
                const jaGenus = species.genera.find(g => g.language.name === 'ja')?.genus || "??? Pokemon";
                
                const flavorEntries = species.flavor_text_entries.slice().reverse();
                const jaFlavor = flavorEntries.find(e => e.language.name === 'ja');
                const kanaFlavor = flavorEntries.find(e => e.language.name === 'ja-Hrkt');
                const enFlavor = flavorEntries.find(e => e.language.name === 'en');
                let description = jaFlavor ? jaFlavor.flavor_text.replace(/\s+/g, '') 
                                : kanaFlavor ? kanaFlavor.flavor_text.replace(/\s+/g, '') 
                                : enFlavor ? enFlavor.flavor_text.replace(/[\n\f\r]/g, ' ') + " (EN Data)" 
                                : "NO DATA FOUND (データなし)";

                const jaAbilities = abilitiesData.map(d => {
                    const ja = d.names.find(n => n.language.name === 'ja');
                    return ja ? ja.name : d.name;
                });

                // Play Cry
                const cryUrl = pokemon.cries.legacy || pokemon.cries.latest;
                if (cryUrl) {
                    cryAudio.src = cryUrl;
                    cryAudio.volume = 0.4;
                    await cryAudio.play().catch(e => console.log('Audio blocked', e));
                }

                updateUI(pokemon, species, jaName, enName, jaGenus, description, jaAbilities);

            } catch (error) {
                console.error(error);
                alert('Connection Error (通信エラー). System Offline.');
                setLoading(false);
            }
        }

        function updateUI(pokemon, species, jaName, enName, jaGenus, description, jaAbilities) {
            setLoading(false);
            placeholder.classList.add('hidden');
            
            // Layout Fixes for Mobile vs Desktop
            // PC: pokemonVisual is visible (flex). Mobile: pokemonVisual is hidden (by CSS class hidden md:flex)
            // DO NOT force flex here, let CSS handle responsive
            // Just ensure it's not 'hidden' by logic if it was logically hidden (which it isn't, it's structurally hidden)
            // pokemonVisual.classList.remove('hidden'); <-- Removed this to respect 'hidden md:flex'
            
            pokemonDataPanel.classList.remove('hidden');

            // --- Basic Info ---
            pokeIdLarge.textContent = `No.${String(pokemon.id).padStart(4, '0')}`;
            pokeName.textContent = jaName;
            pokeEnName.textContent = enName;
            pokeGenus.textContent = jaGenus;
            
            // --- Image ---
            updateImage();

            // --- Styling & Background ---
            const mainType = pokemon.types[0].type.name;
            typeBg.className = `absolute inset-0 transition-all duration-1000 ease-in-out opacity-40 bg-gradient-${mainType}`;

            // --- Types ---
            pokeTypes.innerHTML = '';
            pokeTypesMobile.innerHTML = ''; // Clear mobile types
            
            pokemon.types.forEach(t => {
                const typeName = translateType(t.type.name);
                
                // Desktop Badges
                const badge = document.createElement('div');
                badge.className = `type-badge px-4 py-1.5 rounded text-sm font-bold text-white uppercase tracking-wider bg-black/40 backdrop-blur-md`;
                badge.style.borderLeft = `4px solid ${getTypeColor(t.type.name)}`;
                badge.textContent = typeName;
                pokeTypes.appendChild(badge);

                // Mobile Badges (Clone for mobile view)
                const badgeMobile = badge.cloneNode(true);
                badgeMobile.className = `type-badge px-3 py-1 rounded text-xs font-bold text-white uppercase tracking-wider bg-black/40 backdrop-blur-md`;
                badgeMobile.style.borderLeft = `3px solid ${getTypeColor(t.type.name)}`;
                pokeTypesMobile.appendChild(badgeMobile);
            });

            // --- Abilities ---
            pokeAbilities.innerHTML = '';
            jaAbilities.forEach(abilityName => {
                const chip = document.createElement('span');
                chip.className = 'px-3 py-1 rounded text-xs font-bold text-gray-200 bg-white/10 border border-white/5';
                chip.textContent = abilityName;
                pokeAbilities.appendChild(chip);
            });

            // --- Egg Groups ---
            pokeEggGroups.innerHTML = '';
            species.egg_groups.forEach(g => {
                const jaEgg = translateEggGroup(g.name);
                const tag = document.createElement('span');
                tag.className = 'px-3 py-1 rounded text-xs text-gray-400 border border-gray-700 bg-black/20';
                tag.textContent = jaEgg;
                pokeEggGroups.appendChild(tag);
            });

            // --- Gender Ratio ---
            updateGender(species.gender_rate);

            // --- Stats ---
            pokeHeight.textContent = `${(pokemon.height / 10).toFixed(1)}m`;
            pokeWeight.textContent = `${(pokemon.weight / 10).toFixed(1)}kg`;

            updateStat('hp', pokemon.stats[0].base_stat);
            updateStat('atk', pokemon.stats[1].base_stat);
            updateStat('def', pokemon.stats[2].base_stat);
            updateStat('spa', pokemon.stats[3].base_stat);
            updateStat('spd', pokemon.stats[4].base_stat);
            updateStat('spe', pokemon.stats[5].base_stat);

            // --- Description ---
            typeWriter(description, pokeDesc);
        }

        // --- Shiny Toggle ---
        function toggleShiny() {
            if (!currentPokemon) return;
            isShiny = !isShiny;
            updateImage();
            updateShinyButton();
        }

        function updateImage() {
            if (!currentPokemon) return;
            
            let spriteUrl;
            if (isShiny) {
                spriteUrl = currentPokemon.sprites.other.showdown.front_shiny 
                         || currentPokemon.sprites.front_shiny
                         || currentPokemon.sprites.other['official-artwork'].front_shiny;
            } else {
                spriteUrl = currentPokemon.sprites.other.showdown.front_default 
                         || currentPokemon.sprites.front_default
                         || currentPokemon.sprites.other['official-artwork'].front_default;
            }
            if (!spriteUrl) spriteUrl = currentPokemon.sprites.front_default;

            pokeImg.src = spriteUrl;
            if(pokeImgMobile) pokeImgMobile.src = spriteUrl;

            pokeImg.classList.remove('pop-in');
            void pokeImg.offsetWidth; 
            pokeImg.classList.add('pop-in');
            
            if(pokeImgMobile) {
                pokeImgMobile.classList.remove('pop-in');
                void pokeImgMobile.offsetWidth; 
                pokeImgMobile.classList.add('pop-in');
            }
        }

        function updateShinyButton() {
            if (isShiny) shinyBtn.classList.add('active');
            else shinyBtn.classList.remove('active');
        }

        // --- Gender Logic ---
        function updateGender(rate) {
            genderUnknown.classList.add('hidden');
            genderMale.classList.remove('hidden');
            genderFemale.classList.remove('hidden');

            if (rate === -1) {
                genderText.textContent = "Unknown";
                genderMale.style.width = '0%';
                genderFemale.style.width = '0%';
                genderUnknown.classList.remove('hidden');
            } else {
                const femalePercent = (rate / 8) * 100;
                const malePercent = 100 - femalePercent;
                
                genderMale.style.width = `${malePercent}%`;
                genderFemale.style.width = `${femalePercent}%`;
                
                if (rate === 0) genderText.textContent = "♂ 100%";
                else if (rate === 8) genderText.textContent = "♀ 100%";
                else genderText.textContent = `♂${malePercent} : ♀${femalePercent}`;
            }
        }

        // --- Helpers ---
        function getTypeColor(type) {
             const colors = {
                normal: '#A8A77A', fire: '#EE8130', water: '#6390F0', electric: '#F7D02C',
                grass: '#7AC74C', ice: '#96D9D6', fighting: '#C22E28', poison: '#A33EA1',
                ground: '#E2BF65', flying: '#A98FF3', psychic: '#F95587', bug: '#A6B91A',
                rock: '#B6A136', ghost: '#735797', dragon: '#6F35FC', dark: '#705746',
                steel: '#B7B7CE', fairy: '#D685AD', stellar: '#4F96BB'
            };
            return colors[type] || '#777';
        }

        function translateType(type) {
            const types = {
                normal: 'ノーマル', fire: 'ほのお', water: 'みず', electric: 'でんき',
                grass: 'くさ', ice: 'こおり', fighting: 'かくとう', poison: 'どく',
                ground: 'じめん', flying: 'ひこう', psychic: 'エスパー', bug: 'むし',
                rock: 'いわ', ghost: 'ゴースト', dragon: 'ドラゴン', dark: 'あく',
                steel: 'はがね', fairy: 'フェアリー', stellar: 'ステラ'
            };
            return types[type] || type;
        }

        function translateEggGroup(group) {
            const groups = {
                monster: '怪獣', water1: '水中1', bug: '虫', flying: '飛行',
                ground: '陸上', fairy: '妖精', plant: '植物', humanshape: '人型',
                water3: '水中3', mineral: '鉱物', indeterminate: '不定形',
                water2: '水中2', ditto: 'メタモン', dragon: 'ドラゴン',
                'no-eggs': '未発見'
            };
            return groups[group] || group;
        }

        function updateStat(idSuffix, value) {
            const maxStat = 255; 
            const percentage = Math.min((value / maxStat) * 100, 100);
            
            const bar = document.getElementById(`stat-${idSuffix}`);
            const label = document.getElementById(`val-${idSuffix}`);
            
            bar.style.width = '0%';
            // Small delay for staggered animation
            setTimeout(() => {
                bar.style.width = `${percentage}%`;
            }, 100);
            
            label.textContent = value;
        }

        function setLoading(isLoading, text = "LOADING...") {
            if (isLoading) {
                loading.classList.remove('hidden');
                loadingText.textContent = text;
            } else {
                loading.classList.add('hidden');
            }
        }

        let typeWriterTimeout;
        function typeWriter(text, element) {
            if (typeWriterTimeout) clearTimeout(typeWriterTimeout);
            element.textContent = "";
            let i = 0;
            function type() {
                if (i < text.length) {
                    element.textContent += text.charAt(i);
                    i++;
                    typeWriterTimeout = setTimeout(type, 20);
                }
            }
            type();
        }
    </script>
</body>
</html>
